<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009"
		 xmlns:s="library://ns.adobe.com/flex/spark"
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		 xmlns:products="com.components.products.*"
		 xmlns:controls="com.adobe.flex.extras.controls.*"
		 xmlns:components="com.hillelcoren.components.*"
		 width="1232" height="674" initialize="group1_initializeHandler(event)">
	<fx:Script>
		<![CDATA[
			import assets.DataGridUtil;
			
			import com.actions.CabeceraNota;
			import com.actions.Historico;
			import com.actions.detallesVerNotas;
			import com.components.products.DatosProducto;
			
			import flash.desktop.Clipboard;
			import flash.desktop.ClipboardFormats;
			
			import flashx.textLayout.formats.WhiteSpaceCollapse;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.events.AdvancedDataGridEvent;
			import mx.events.CloseEvent;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			
			import org.osmf.net.SwitchingRuleBase;
			
			import popus.Progress;
			
			import spark.events.TextOperationEvent;
			private var popup:Progress;
			[Bindable]
			private var xmltarjetas:XMLList;
			[Bindable]
			private var xmlListEmpleados:XMLList;
			[Bindable]
			private var anticipo:Number=0;
			[Bindable]
			public var dp:Array=[];
			[Bindable]
			public var totGral:Number;
			[Bindable]
			public var totRecargo:Number;
			[Bindable]
			public var totGralDesc:Number;
			[Bindable]
			private var precio_desc:Number;
			[Bindable]
			public var porc_d:Number;
			[Bindable]
			public var porc_desc_total:Number=0;
			[Bindable]
			public var desc_resto:Number=0;
			[Bindable]
			public var tot_recargo_porc:Number=0;
			[Bindable]
			public var temp_tot_porc_desc:Number=0;
			[Bindable]
			private var indexPage:int=0;
			[Bindable]
			private static var SIZEPAGE:int=5;
			[Bindable]
			private var userexpidio:int=0;
			[Bindable]
			private var usercancelo:int=0;
			[Bindable]
			private var userEntrego:int=0;
			[Bindable]
			private var useranulo:int=0;
			[Bindable]
			private var xmlproduct:XMLList;
			private var totalReg:int=0;
			[Bindable]
			private static var TOTALPAGES:int=0;
			[Bindable]
			private var pageEnum:int=0;
			[Bindable]
			private var xmlNotas:XMLList;
			[Bindable]
			private var detalles:detallesVerNotas;
			[Bindable]
			private var idcliente:int;
			[Bindable]
			private var nrodocucli:int;
			[Bindable]
			private var feentrega:String;
			[Bindable]
			private var stockfuturo:String;
			[Bindable]
			private var efectivo:String;
			[Bindable]
			private var idnota:int=0;
			[Bindable]
			private var systemClipboard:Clipboard = Clipboard.generalClipboard;
			/**
			 * metodo que se invoca como resultado de obtener desde la base de datos
			 * la cantidad de registros nota de pedido
			 * invocamos a seleccionar todas o al metodo que trae solo un puñado de las mismas
			 * */
			protected function getRecordCountNotasHandler(event:ResultEvent):void
			{
				
				
				totalReg = int(event.result.toString());
				
				if(totalReg==0){
					Alert.show("   NO HAY NOTAS DE PEDIDO CARGADAS AÚN!!!   ");
				}else{
					
					if(totalReg<SIZEPAGE){
						
						wsnotas.selectAllNotas();
						if(totGral>0)
							limpiarControles();
					}else{
						
						
						last_btn.enabled=true;
						next_btn.enabled=true;
						first_btn.enabled=true;
						prev_btn.enabled=true;
						
						TOTALPAGES=int(totalReg/SIZEPAGE);		
						
						wsnotas.verNotasPedidoPaginadas(indexPage,SIZEPAGE);
						
						if(totGral>0)
							limpiarControles();
					}
				
				}
				
			}
			
			protected function getFaultRecordCountHandler(event:FaultEvent):void
			{
				Alert.show("   ERROR AL BUSCAR CANTIDAD TOTAL DE\n NOTAS DE PEDIDO EN BASE DE DATOS   ");
			}
			
			protected function operation2_resultHandler(event:ResultEvent):void
			{
				
				
				xmlNotas=new XMLList(event.result);
				
				addgrid();
				adgNotas.selectedIndex=0;
				adgNotas.validateNow();
				addinfo();
			}
			
			//----------------------------------------------------------------------------------------------
			private function addgrid():void{
				// agrego la cabecera de la nota de pedido al grid
				var headerNota:CabeceraNota;
				adgNotas.dataProvider=notas;			
				
				

				if(detallenotas.length>0)
					detallenotas.removeAll();
				
				
				
				
				if(btnImprimir.enabled==false)
					btnImprimir.enabled=true;
				if(btnRegargarlistado.enabled==false)
					btnRegargarlistado.enabled=true;
				
				if(btnRemover.enabled==false)
					btnRemover.enabled=true;
				
				
				
				
			}
			//---------------------------------------------------------------------------------
			
			protected function operation2_faultHandler(event:FaultEvent):void
			{
				Alert.show("ERROR VERIFIQUE");
				
			}
			
			protected function first_clickHandler(event:MouseEvent):void
			{
				if(indexPage==0){
					first_btn.enabled=false;
					prev_btn.enabled=false;
					last_btn.enabled=true;
					next_btn.enabled=true;
				}else{
					indexPage=0;
					wsnotas.verNotasPedidoPaginadas(indexPage,SIZEPAGE);
					first_btn.enabled=false;
					prev_btn.enabled=false;
					last_btn.enabled=true;
					next_btn.enabled=true;
					
					
				}
				
			}
			//-------------------------------------------------------------------------------------
			//-------------------------------------------------------------------------------------
			protected function prev_btn_clickHandler(event:MouseEvent):void
			{
				
				if(indexPage==0)
					first_clickHandler(event);
				else{
					indexPage--;
						if(last_btn.enabled==false){
							last_btn.enabled=true;
							next_btn.enabled=true;
						}
					  if(indexPage==0){
						first_btn.enabled=false;
						prev_btn.enabled=false;
						last_btn.enabled=true;
						next_btn.enabled=true;
						
					  }
					
					wsnotas.verNotasPedidoPaginadas(indexPage,SIZEPAGE);
					
					
				}
				
			}
			//-------------------------------------------------------------------------------------------
			//-------------------------------------------------------------------------------------------
			protected function next_btn_clickHandler(event:MouseEvent):void
			{
				
				if(indexPage==TOTALPAGES)
					last_clickHandler(event);
				else{
					indexPage++;
					if(first_btn.enabled==false){
						first_btn.enabled=true;
						prev_btn.enabled=true;
					}
					if(indexPage==TOTALPAGES){
						last_btn.enabled=false;
						next_btn.enabled=false;
						first_btn.enabled=true;
						prev_btn.enabled=true;
					}
					
					wsnotas.verNotasPedidoPaginadas(indexPage,SIZEPAGE);
					
				}
				
			}
			//-------------------------------------------------------------------------------------------------------
			//-------------------------------------------------------------------------------------------------------
			protected function last_clickHandler(event:MouseEvent):void
			{
				if(indexPage==TOTALPAGES){
					last_btn.enabled=false;
					next_btn.enabled=false;
					first_btn.enabled=true;
					prev_btn.enabled=true;
				}else{
					indexPage=TOTALPAGES;
					wsnotas.verNotasPedidoPaginadas(indexPage,SIZEPAGE);
					last_btn.enabled=false;
					next_btn.enabled=false;
					first_btn.enabled=true;
					prev_btn.enabled=true;
					
					
				}
				
			}
			//-------------------------------------------------------------------------------------------------------------
			
			protected function resultPaginadoHandler(event:ResultEvent):void
			{
				xmlNotas=new XMLList(event.result);				
				addgrid();
				adgNotas.selectedIndex=0;
				adgNotas.validateNow();
				addinfo();				
				
			}
			
			protected function faultPaginadoHandler(event:FaultEvent):void
			{
				Alert.show("ERROR AL OBTENER LAS NOTAS ");
				
			}
			
			
			//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			private function formatDateTime(date:Date):String {
				return dtf.format(date);
			} 
			//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			protected function addinfo():void{
			
				var historico:Historico;
				var ultimaActualizacion:String = String(notas[adgNotas.selectedIndex].ultimaActualizacion);
				
				if(btnEliminarNota.enabled==false)
					btnEliminarNota.enabled=true;
				
				lblnombreyapecli.text=String(notas[adgNotas.selectedIndex].cliente.apellidoynombre);
				
								if(ultimaActualizacion.toString().indexOf("01/01/1900")==-1){
									
									lblUltimaActualizacion.text = "Última Actualización: " +ultimaActualizacion;
								}else{
									lblUltimaActualizacion.text = "";
								}
				
				nrodocucli=int(notas[adgNotas.selectedIndex].cliente.nrodocumento);
				idcliente=int(notas[adgNotas.selectedIndex].cliente.id);
				idnota=notas[adgNotas.selectedIndex].id;
				feentrega=String(notas[adgNotas.selectedIndex].fechaentrega);
				stockfuturo=String(notas[adgNotas.selectedIndex].stockfuturo);
				efectivo=String(notas[adgNotas.selectedIndex].efectivo);
				txtobservaciones.text=String(notas[adgNotas.selectedIndex].observaciones);
				cmbTarjetasCreditoDebito.selectedItemId=notas[adgNotas.selectedIndex].idtarjeta;
				txtNumerodeCuponPagoTarjeta.text=notas[adgNotas.selectedIndex].numerocupon;
				detallenotas.source=notas[adgNotas.selectedIndex].detallenota.itemdetalle;		
				
				mskdocumento.text=String(nrodocucli);
				
			
				
				desc_resto=Number(notas[adgNotas.selectedIndex].descuentopesos);
				
									if(Number(notas[adgNotas.selectedIndex].usuarioexpidionota)==Number(0))
										lblexpidiovendedor.text="-";
									else 
										lblexpidiovendedor.text=notas[adgNotas.selectedIndex].usuarioexpidionota;
									
									if(Number(notas[adgNotas.selectedIndex].usuariocancelonota)==Number(0))
										lblvendedocancelo.text="-";
									else
										lblvendedocancelo.text=notas[adgNotas.selectedIndex].usuariocancelonota;
									
									if(notas[adgNotas.selectedIndex].usuarioanulonota==0)
										lblvendedoranulo.text="-";
									else
										lblvendedoranulo.text=notas[adgNotas.selectedIndex].usuarioanulonota;
									
									if(Number(notas[adgNotas.selectedIndex].usuarioentregonota)==Number(0))
										lblvendedorentrego.text="-";
									else
										lblvendedorentrego.text=notas[adgNotas.selectedIndex].usuarioentregonota;
				
				mskrecargo.text=notas[adgNotas.selectedIndex].porcrecargo;
				
				userexpidio=notas[adgNotas.selectedIndex].idusuarioexpidionota;
				userEntrego=notas[adgNotas.selectedIndex].idusuarioentregonota;
				usercancelo=notas[adgNotas.selectedIndex].idusuariocancelonota;
				useranulo=notas[adgNotas.selectedIndex].idusuarioanulonota;
				
				listhistoricoselected.source=notas[adgNotas.selectedIndex].detallehistorico.item;
				
				
				
								if(int(notas[adgNotas.selectedIndex].anulado)==0){
									rdbAnuladano.selected=true;
									}else{
										rdbAnuladasi.selected=true;
									}
														
							if(int(notas[adgNotas.selectedIndex].cancelado)==0){
									rdbcanceladanotano.selected=true;
									btnCancelarNota.enabled=true;
							}else{
									rdbcanceladanotasi.selected=true;
									btnCancelarNota.enabled=false;
							}
				
							if(int(notas[adgNotas.selectedIndex].entregado)==0){
								rdbentregadono.selected=true;
								btnEntregarNota.enabled=true;
							}else{							
								rdbentregadosi.selected=true;
								btnEntregarNota.enabled=false;
							}
				
							if(listhistorico.length>0)								
								listhistorico.removeAll();
								
								
							
				
				//***********************************************************************************************************++
				
				anticipo=0;
				for (var j:int=0;j<listhistoricoselected.length;j++){
					//recorro la coleccion historico para mostrar los anticipo de la nota
					if(Number(listhistoricoselected[j].anticipo)>0){
						
						historico =new Historico();
						historico.anticipo=listhistoricoselected[j].anticipo;
						anticipo=anticipo+Number(Number(listhistoricoselected[j].anticipo).toFixed(3));
						historico.fecharegistro=listhistoricoselected[j].fecharegistro;
						
						listhistorico.addItem(historico);
						
					}
					
					
				}
				
				
				
				adghistorico.dataProvider=listhistorico;
				//*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
				
				
				
				addDetalles();
			
			}
			//-----------------------------------------------------------------------------------------------------
			protected function adgNotas_doubleClickHandler(event:MouseEvent):void
			{
				addinfo();
				
			}
			protected function addDetalles():void{
				
				
				
				
			var b:Boolean=false;
			
			
			
			while(dp.length>0){
					dp.pop();
			
			}
			
			
			
			
				for(var i:int=0;i<detallenotas.length;i++){
					
							detalles=new detallesVerNotas();
							detalles.code=detallenotas[i].producto.code;
							detalles.countt=detallenotas[i].cantidad;
							detalles.id=detallenotas[i].producto.id;
							detalles.idnota=detallenotas[i].idnota;
							detalles.name=detallenotas[i].producto.descripcion;
							detalles.price=detallenotas[i].precio;
							detalles.porc_desc=detallenotas[i].descuento;
							detalles.prec_descuento=detallenotas[i].preciocondescuento;
							detalles.subtotal=detallenotas[i].subtotal;
							
					if(int(detallenotas[i].descuento)>0&&b==false)
						b=true;
							
			
							
							
					detallenotasList.addItem(detalles);
					
							
					
					
					dp.push({idproduct:detallenotas[i].producto.code,id:detallenotas[i].producto.id,name:detallenotas[i].producto.descripcion,countt:detallenotas[i].cantidad,price:detallenotas[i].precio,porc_desc:detallenotas[i].descuento,prec_descuento:detallenotas[i].preciocondescuento,subtotal:detallenotas[i].subtotal,idnota:detallenotas[i].idnota});
					
					
							
				}
					
				if(b==false)
					txtdescuento.text=notas[adgNotas.selectedIndex].porcentajedesctotal;
				
				totGral=notas[adgNotas.selectedIndex].total;
				
				tot_recargo_porc=notas[adgNotas.selectedIndex].porcrecargo;
				totGralDesc=Math.abs(Number(notas[adgNotas.selectedIndex].descuentonota));
				porc_desc_total=notas[adgNotas.selectedIndex].porcentajedesctotal;
				totRecargo=notas[adgNotas.selectedIndex].recargototal;
				
			
				
				
				
				mskrecargo.text=notas[adgNotas.selectedIndex].porcrecargo;
				
				
				
				
				//************************************************************************************+
				//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
				
				lblTotGral.text=totGral.toFixed(3);
				lbldescuento.text=Number(Number(notas[adgNotas.selectedIndex].descuentonota)).toFixed(3);
				lblTotApagar.text=Number(Number(notas[adgNotas.selectedIndex].montototalapagar)).toFixed(3);
				lblsaldo.text=Number(Number(notas[adgNotas.selectedIndex].saldo)).toFixed(3);
				lbltotalconrecargo.text=Number(Number(notas[adgNotas.selectedIndex].recargototal)).toFixed(3);
				
				
				
				
				
				
				
				
				//----------------------------------------------------------------------------------------------------------
				//**************************************************************************************
				
				
				
				
				detallenotasList.refresh();
				arrayDg.refresh();
				
				arrayDg.source=dp;
				
				adglistpedprod.dataProvider=arrayDg;
				
				
				
			
				
				
			
				
			
			
			}
			
			
			//------------------------------------------------------------------------------------------------
			protected function itemEditEndHandler(event:AdvancedDataGridEvent):void
			{
				// get a reference to the datagrid
				var grid:AdvancedDataGrid = event.target as AdvancedDataGrid;
				// get a reference to the name of the property in the
				// underlying object corresponding to the cell that's being edited
				var field:String = event.dataField;
				// get a reference to the row number (the index in the 
				// dataprovider of the row that's being edited)
				var row:Number = Number(event.rowIndex);
				// get a reference to the column number of
				// the cell that's being edited
				var col:int = event.columnIndex;
				var precio_descontado_result_porcentaje:Number=0;
				var precio:Number=0;
				var porcentajedescuento:Number=0;
				var decimal:Number=Math.pow(10,2);
				var temptot:Number=0;
				var tempPrecDesc:Number=0;
				var tempTotDesc:Number=0;
				var tempPorcDes:Number=0;
				
				
				
				
				if (grid != null)
				{
					
					// gets the value (pre-edit) from the grid's dataprovider
					var oldValue:Number = Number(grid.dataProvider.getItemAt(row)[field]);
					// you could also use the following line to get the value
					// directly from the cellrenderer that's showing the value
					// in the datagrid -- it's the same value.
					// That way you wouldn't need a reference to the DataGrid.
					//var oldValue = event.itemRenderer.data[field];
					// get the value (post-edit) from the item editor
					var newValue:Number = Number(grid.itemEditorInstance[grid.columns[col].editorDataField]);
					
					
					
					// check if the value has changed
					if (newValue != oldValue)
					{
						
						
						
						// do actions that should happen when the data changes
						// Note that in this case, the dataprovider
						// hasn't been updated yet, so you can't do any
						// actions that require the dataprovider to have 
						// the new data
						
						if(col==4){
							var priceValue:Number=(grid.selectedItem.price);
							var subtot1:Number=(grid.selectedItem.subtotal);
							
							
							//---------------------------------------------------------------------------------------------------------------------------------------
							if(col==4&&arrayDg.length==1&&newValue==0){
								
								grid.dataProvider.removeItemAt(grid.selectedIndex);
								
								totGral=0;
								totGralDesc=0;
								precio_desc=0;
								txtdescuento.text="0.0";
								useranulo=0;
								userEntrego=0;
								usercancelo=0;
								userexpidio=0;
								txtpreciop.text="";
								mskcantidad.text="";		
								mskrecargo.text="0.0";
								mskdescuentopesos.text="0.0";
								mskAnticipo.text="0.0";
								btnRemover.enabled=false;
								lblTotApagar.text="0.000";
								lblTotGral.text="0.000";
								
								porc_d=0;
								anticipo=0;
								porc_desc_total=0;		
								lbldescuento.text="0.000";
								lblsaldo.text="0.000";
								lbltotalconrecargo.text="0.000";
								desc_resto=0;
								tot_recargo_porc=0;
								temp_tot_porc_desc=0;
								tempPorcDes=0;
								tempTotDesc=0;
								
								
							}else{
								
								//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
								if(newValue>0){
									
									if(grid.selectedItem.prec_descuento>0){
										var newpricexcountt:Number=grid.selectedItem.countt*Number(Number(newValue).toFixed(3));
										var descitemporc:Number=Number(Number(grid.selectedItem.porc_desc).toFixed(3))*newValue/100;
										
										
										grid.selectedItem.prec_descuento=Number(Number(newValue-descitemporc).toFixed(3));
										
										
										grid.selectedItem.subtotal=Number(Number(newValue-descitemporc)*grid.selectedItem.countt).toFixed(3);
										
									}else
										grid.selectedItem.subtotal=newValue*grid.selectedItem.countt;
									
									
									
									if(arrayDg.length==1){
										totGral=Number(newValue*grid.selectedItem.countt);
										
										
										if(Number(lbldescuento.text)!=0)
											lblTotApagar.text=Number(totGral-totGralDesc).toFixed(3);
									}else{
										temptot=temptot+(newValue*grid.selectedItem.countt);
										
										for(var i:int=0;i<arrayDg.length;i++){
											if(arrayDg[i].idproduct!=grid.selectedItem.idproduct){
												
												if(arrayDg[i].porc_desc>0){
													tempTotDesc=tempTotDesc+Number(Number(arrayDg[i].prec_descuento).toFixed(3));
													tempPorcDes=tempPorcDes+Number(Number(arrayDg[i].porc_desc).toFixed(3));
												}
												if(arrayDg[i].subtotal>0)
													temptot=temptot+(arrayDg[i].price*arrayDg[i].countt);
												
											}
											
										}
										
										
										totGral=temptot;
										
										totGralDesc=0;
										
										totGralDesc=Number(tempTotDesc.toFixed(3))+Number(Number(grid.selectedItem.prec_descuento).toFixed(3));
										
										temp_tot_porc_desc=0;
										
										temp_tot_porc_desc=Number(tempPorcDes.toFixed(3))+Number(Number(grid.selectedItem.porc_desc).toFixed(3));
										
										if(Number(lbldescuento.text)!=0)
											lblTotApagar.text=Number(totGral+Number(lbldescuento.text)).toFixed(3);
									}
									
									
									
								}else{
									if(newValue==0&&grid.selectedIndex>0&&col==4){
										grid.selectedItem.price="0.00";
										grid.selectedItem.subtotal="0.000";
										grid.selectedItem.prec_descuento="0.00";
										grid.selectedItem.porc_desc="0.00";
										var newTotalTemp:Number=0;	
										for(var l:int=0;l<arrayDg.length;l++){
											
											if(arrayDg[l].idproduct!=grid.selectedItem.idproduct){
												
												if(arrayDg[l].porc_desc>0){
													tempTotDesc=tempTotDesc+Number(arrayDg[l].prec_descuento);
													tempPorcDes=tempPorcDes+Number(arrayDg[l].porc_desc);
												}
												if(arrayDg[l].subtotal>0)
													newTotalTemp=newTotalTemp+Number(Number(arrayDg[l].price*arrayDg[l].countt).toFixed(3));
												
											}
										}
										
										totGral=newTotalTemp;
										
										totGralDesc=0;
										
										totGralDesc=Number(tempTotDesc.toFixed(3));
										
										temp_tot_porc_desc=0;
										
										temp_tot_porc_desc=Number(tempPorcDes.toFixed(3));
										
										
										
										
										
									}else{
										
										var newTotalTemp1:Number=0;	
										
										grid.selectedItem.price="0.00";
										grid.selectedItem.subtotal="0.000";
										grid.selectedItem.prec_descuento="0.00";
										grid.selectedItem.porc_desc="0.00";
										
										for(var lm:int=0;lm<arrayDg.length;lm++){
											
											if(arrayDg[lm].idproduct!=grid.selectedItem.idproduct){
												
												if(arrayDg[lm].porc_desc>0){
													tempTotDesc=tempTotDesc+Number(arrayDg[lm].prec_descuento);
													tempPorcDes=tempPorcDes+Number(arrayDg[lm].porc_desc);
												}
												if(arrayDg[lm].subtotal>0)
													newTotalTemp1=newTotalTemp1+Number(Number(arrayDg[lm].price*arrayDg[lm].countt).toFixed(3));
												
											}
										}
										
										totGral=newTotalTemp1;
										
										totGralDesc=0;
										
										totGralDesc=Number(tempTotDesc.toFixed(3));
										
										temp_tot_porc_desc=0;
										
										temp_tot_porc_desc=Number(tempPorcDes.toFixed(3));
										
										
										
										
										
									}
									
									
								}
								//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
							}
							//---------------------------------------------------------------------------------------------------------------------------------
							
						}else{
							if(col==3){
								var cannt:Number=(grid.selectedItem.countt);
								var subtot:Number=(grid.selectedItem.subtotal);
								//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
								if(col==3&&arrayDg.length==1&&newValue==0){
									
									grid.dataProvider.removeItemAt(grid.selectedIndex);
									
									totGral=0;
									totGralDesc=0;
									precio_desc=0;
									txtdescuento.text="0.0";
									useranulo=0;
									userEntrego=0;
									usercancelo=0;
									userexpidio=0;
									txtpreciop.text="";
									mskcantidad.text="";	
									mskrecargo.text="0.0";
									btnRemover.enabled=false;
									lblTotApagar.text="0.000";
									mskdescuentopesos.text="0.0";
									mskAnticipo.text="0.0";
									lblTotGral.text="0.000";
									porc_d=0;
									porc_desc_total=0;	
									
									lbldescuento.text="0.000";
									lblsaldo.text="0.000";
									lbltotalconrecargo.text="0.000";
									desc_resto=0;
									tot_recargo_porc=0;
									temp_tot_porc_desc=0;
									tempPorcDes=0;
									tempTotDesc=0;
									
									//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++	
								}else{
									
									
									
									if(col==3&&newValue>0){
										var toti:Number=0;	
										if(grid.selectedItem.prec_descuento>0){
											
											
											grid.selectedItem.subtotal=newValue*Number(Number(grid.selectedItem.prec_descuento).toFixed(3));
											
											
											
											
											
										}else{
											
											grid.selectedItem.subtotal=newValue*grid.selectedItem.price;
											
											
										}
										
										toti=toti+Number(Number(grid.selectedItem.price*newValue).toFixed(3));
										
										
										
										if(arrayDg.length==1){
											totGral=Number(grid.selectedItem.price*newValue);
											if(Number(lbldescuento.text)!=0){
												
												lblTotApagar.text=Number(totGral-totGralDesc).toFixed(3);
											}
										}else{
											
											
											
											
											
											
											
											for(var n:int=0;n<arrayDg.length;n++){
												if(arrayDg[n].idproduct!=grid.selectedItem.idproduct){
													
													if(arrayDg[n].subtotal>0)
														toti=toti+Number(Number(arrayDg[n].price*arrayDg[n].countt).toFixed(3));
													
													if(arrayDg[n].porc_desc>0&&arrayDg[n].subtotal>0){
														tempTotDesc=tempTotDesc+Number(arrayDg[n].prec_descuento);
														tempPorcDes=tempPorcDes+Number(arrayDg[n].porc_desc);
														
													}
													
													
												}
											}
											
											
											totGralDesc=0;
											temp_tot_porc_desc=0;
											
											if(grid.selectedItem.prec_descuento>0){
												totGralDesc=Number(tempTotDesc.toFixed(3))+Number(Number(grid.selectedItem.prec_descuento).toFixed(3));
												temp_tot_porc_desc=Number(tempPorcDes.toFixed(3))+Number(Number(grid.selectedItem.porc_desc).toFixed(3));
											}else{
												totGralDesc=Number(tempTotDesc.toFixed(3));
												temp_tot_porc_desc=Number(tempPorcDes.toFixed(3));
											}
											
											
											
											
											
											
											
											totGral=toti;
											
											
											
											
										}
										
										
										
										
										
										
									}else{
										var tottemp:Number=0;
										if(col==3&&newValue==0&&grid.selectedIndex>0){
											
											grid.selectedItem.countt="0";
											grid.selectedItem.subtotal="0.000";
											grid.selectedItem.porc_desc="0.0";
											grid.selectedItem.prec_descuento="0.0";
											
											
											for(var m:int=0;m<arrayDg.length;m++){
												if(arrayDg[m].idproduct!=grid.selectedItem.idproduct){
													
													if(arrayDg[m].porc_desc>0){
														tempTotDesc=tempTotDesc+Number(arrayDg[m].prec_descuento);
														tempPorcDes=tempPorcDes+Number(arrayDg[m].porc_desc);
													}
													if(arrayDg[m].subtotal>0)
														tottemp=tottemp+Number(Number(arrayDg[m].price*arrayDg[m].countt).toFixed(3));
												}
											}
											
											totGral=0;
											
											totGral=tottemp;
											
											totGralDesc=0;
											
											totGralDesc=Number(tempTotDesc.toFixed(3));
											
											temp_tot_porc_desc=0;
											
											temp_tot_porc_desc=Number(tempPorcDes.toFixed(3));
											
											
											
											
										}else{
											if(col==3&&newValue==0&&grid.selectedIndex==0)
												
												grid.selectedItem.countt="0";
												grid.selectedItem.subtotal="0.00";
												grid.selectedItem.porc_desc="0.0";
												grid.selectedItem.prec_descuento="0.0";
												
											
											
											for(var r:int=0;r<arrayDg.length;r++){
												if(arrayDg[r].idproduct!=grid.selectedItem.idproduct){
													
													if(arrayDg[r].porc_desc>0){
														tempTotDesc=tempTotDesc+Number(arrayDg[r].prec_descuento);
														tempPorcDes=tempPorcDes+Number(arrayDg[r].porc_desc);
													}
													if(arrayDg[r].subtotal>0)
														tottemp=tottemp+Number(Number(arrayDg[r].price*arrayDg[r].countt).toFixed(3));
												}
											}
											
											totGral=tottemp;
											
											totGralDesc=0;
											
											totGralDesc=Number(tempTotDesc.toFixed(3));
											
											temp_tot_porc_desc=0;
											
											temp_tot_porc_desc=Number(tempPorcDes.toFixed(3));
											
											
										}
										
										
										
										
									}
								}
								
							}else{
								if(desc_resto>0){
									grid.selectedItem.porc_desc="0.0";
									return;
								}
								//-----------------------------------------------------------------------------------------------------------------------------
								if(col==5&&oldValue==0){
									//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
									
									if(txtdescuento.text.length>0)
										txtdescuento.text="0.0";
									//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
									
									
									precio=Number(Number(grid.selectedItem.price));
									porcentajedescuento=newValue;
									
									
									
									grid.selectedItem.prec_descuento=Number(precio-Number(Number(grid.selectedItem.price*(porcentajedescuento/100)))).toFixed(3);
									
									grid.selectedItem.subtotal=grid.selectedItem.prec_descuento*grid.selectedItem.countt;
									
									precio_descontado_result_porcentaje=Number(Number(grid.selectedItem.subtotal*(porcentajedescuento/100)));
									
									
									
									
									
									
									//-------------------------------------------------------------------------------------
									
									
									
									if(arrayDg.length==1){
										totGralDesc=Number(grid.selectedItem.prec_descuento);
										
										
										
									}else{
										
										
										for(var p:int=0;p<arrayDg.length;p++){
											
											if(arrayDg[p].idproduct!=grid.selectedItem.idproduct){
												
												
												tempTotDesc=tempTotDesc+Number(arrayDg[p].prec_descuento);
												tempPorcDes=tempPorcDes+Number(arrayDg[p].porc_desc);
												
												
												
											}
										}
										
										
										totGralDesc=0;
										
										
										totGralDesc+=Number(tempTotDesc.toFixed(3))+Number(Number(grid.selectedItem.prec_descuento).toFixed(3));
										
										
										temp_tot_porc_desc=0;
										
										temp_tot_porc_desc=Number(tempPorcDes.toFixed(3))+Number(Number(newValue).toFixed(3));
										
										
										
										
										
										
										
									}
									
									
									
									
									
									
									
								}else{
									if(desc_resto>0){	
										grid.selectedItem.porc_desc="0.0";
										return;
									}
									if(col==5&&newValue==0){
										
										grid.selectedItem.subtotal=grid.selectedItem.price*grid.selectedItem.countt;
										grid.selectedItem.prec_descuento="0.000";
										
										
										if(arrayDg.length==1){
											totGralDesc=Number(grid.selectedItem.prec_descuento);
											
											
											
										}else{
											
											for(var j:int=0;j<arrayDg.length;j++){
												
												if(arrayDg[j].idproduct!=grid.selectedItem.idproduct){
													tempTotDesc=tempTotDesc+Number(arrayDg[j].prec_descuento);
													tempPorcDes=tempPorcDes+Number(arrayDg[j].porc_desc);
												}
												
												
											}
											
											
											
											
											
											totGralDesc=Number(tempTotDesc.toFixed(3));
											
											temp_tot_porc_desc=0;
											
											temp_tot_porc_desc=Number(tempPorcDes.toFixed(3))+Number(Number(newValue).toFixed(3));
											
											
											
											
											
										}
										
										
									}else{
										if(desc_resto>0){	
											grid.selectedItem.porc_desc="0.0";
											return;
										}
										if(col==5&&newValue>0){
											
											porcentajedescuento=newValue;
											
											tempPrecDesc=grid.selectedItem.prec_descuento;
											
											precio=Number(Number(grid.selectedItem.price));
											
											grid.selectedItem.prec_descuento=Number(precio-Number(Number(grid.selectedItem.price*(porcentajedescuento/100)))).toFixed(3);
											
											
											grid.selectedItem.subtotal=grid.selectedItem.prec_descuento*grid.selectedItem.countt;
											
											precio_descontado_result_porcentaje=Number(Number(grid.selectedItem.subtotal*(porcentajedescuento/100)));
											
											
											
											if(arrayDg.length==1){
												totGralDesc=Number(grid.selectedItem.prec_descuento);
												
												
												
											}else{
												
												
												for(var k:int=0;k<arrayDg.length;k++){
													
													if(arrayDg[k].idproduct!=grid.selectedItem.idproduct){
														tempTotDesc=tempTotDesc+Number(arrayDg[k].prec_descuento);
														tempPorcDes=tempPorcDes+Number(arrayDg[k].porc_desc);
													}
													
												}
												
												
												
												
												
												totGralDesc+=Number(tempTotDesc.toFixed(3))+Number(Number(grid.selectedItem.prec_descuento).toFixed(3));
												
												
												
												temp_tot_porc_desc+=Number(tempPorcDes.toFixed(3))+Number(Number(newValue).toFixed(3));
												
												
												
												
												
												
											}
										}
									}
									
									
									
									
									
									
									
									
								}
								//---------------------------------------------------------------------------------------------------------------------------------
								
								
								
							}
							
							
						}
						
						
						
						
					}else
						return;
					
					
					
					
					
				}
				arrayDg.refresh();
				
				//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
				//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
				/*if(int(txtdescuento.text)==0||txtdescuento.text.length==0){
					lblTotGral.text=totGral.toFixed(3);
					lbldescuento.text=Number(Number(-totGralDesc)).toFixed(3);
					
				}*/
				
				
				var calcrecargo:Number=0;
				
				
				if(tot_recargo_porc>0){
					calcrecargo=Number(totGral-totGralDesc)*tot_recargo_porc/100;
					lbltotalconrecargo.text=Number(Number(Number(totGral.toFixed(3))-Number(totGralDesc.toFixed(3)))+Number(calcrecargo.toFixed(3))).toFixed(3);
					
					lblTotApagar.text=Number(Number(Number(totGral.toFixed(3))-Number(totGralDesc.toFixed(3)))+Number(calcrecargo.toFixed(3))).toFixed(3);
					lblsaldo.text=Number(Number(totGral-totGralDesc+calcrecargo)-anticipo).toFixed(3);
				}else{
					lblTotApagar.text=Number(Number(totGral.toFixed(3))-Number(totGralDesc.toFixed(3))).toFixed(3);
					lblsaldo.text=Number(Number(totGral-totGralDesc)).toFixed(3);
				}
				
					
					
					notas[adgNotas.selectedIndex].saldo=lblsaldo.text;
					notas[adgNotas.selectedIndex].montototalapagar=lblTotApagar.text;
					notas[adgNotas.selectedIndex].total=lblTotGral.text;
					notas[adgNotas.selectedIndex].recargototal=lbltotalconrecargo.text;
					notas[adgNotas.selectedIndex].descuentonota=lbldescuento.text;
				
				
					
}//end function edit grid
			
			private function calculeAnticipo():void{
				
					
				
					var calcularsaldo:Number=(Number(Number(lblTotApagar.text).toFixed(3))-Number(mskAnticipo.text))-anticipo;
							if(calcularsaldo<0){
								Alert.show("El calculo del saldo da un número negativo \nverifique o vuelva a calcular");
								return;
							}else{
									
								anticipo=anticipo+Number(Number(mskAnticipo.text).toFixed(3));
								lblsaldo.text=calcularsaldo.toFixed(3);// calculo del saldo
								notas[adgNotas.selectedIndex].saldo=lblsaldo.text;//celda en el grid cabecera del saldo
							}
				
				
			
			
			}
			//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			public function anticipoCalculoReuso():void{				
				if(anticipo==0){
					calculeAnticipo();
					return;
				}else{						
					calculeAnticipo();
					}			
			}
			//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			public function calcularAnticipo(evt:CloseEvent):void{
				
				if ((evt.detail == Alert.NO) || (evt.detail == Alert.CANCEL)) return;
				
				if(int(mskAnticipo.text)==0||mskAnticipo.text.length==0){			
					anticipo=0;
					for (var j:int=0;j<listhistoricoselected.length;j++){
						//recorro la coleccion historico para mostrar los anticipo de la nota
						if(Number(listhistoricoselected[j].anticipo)>0){			
							anticipo=anticipo+Number(Number(listhistoricoselected[j].anticipo).toFixed(3));
						}
					}
					lblsaldo.text=Number(Number(Number(lblTotApagar.text).toFixed(3))-Number(lbldescuento.text)-(anticipo)).toFixed(3);
				}else {
								if(int(mskAnticipo.text)>int(lblTotApagar.text)){
											Alert.show("IMPOSIBLE HACER EL CALCULO DE SALDO");
											return;
								}else{
									anticipoCalculoReuso();									
									}
				}
			}
			//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			public function calcularRecargoVariant():void{
				var recargo:Number=0;
				var totgral:Number=Number(Number(lblTotGral.text).toFixed(3));
				var descTotal:Number=Math.abs(Number(lbldescuento.text));
				
				if(Number(mskrecargo.text)==0||mskrecargo.text.length==0){
					
					tot_recargo_porc=0;
					lbltotalconrecargo.text="0.000";
					lblTotApagar.text=Number(totgral-descTotal).toFixed(3);
					totRecargo=0;
					
					if(anticipo>0)
						lblsaldo.text=Number((totgral-descTotal)-anticipo).toFixed(3);
					
				}else{
					
												
								tot_recargo_porc=tot_recargo_porc+Number(mskrecargo.text);
					
					var calcularTotalAPagar:Number=totgral-descTotal;
					
					recargo=tot_recargo_porc*Number(calcularTotalAPagar.toFixed(3))/100;
					lbltotalconrecargo.text=Number(Number(calcularTotalAPagar.toFixed(3))+recargo).toFixed(3);
					
					var lbltotrecargo:Number=Number(Number(lbltotalconrecargo.text).toFixed(3));					
					var lbltotdesc:Number=Math.abs(Number(lbldescuento.text));
					
					lblTotApagar.text=Number(lbltotrecargo).toFixed(3);
					
					mskrecargo.text=tot_recargo_porc.toFixed(2);
					totRecargo=recargo;
					
					notas[adgNotas.selectedIndex].recargototal=totRecargo.toFixed(3);
					
					if(anticipo>0)
						lblsaldo.text=Number(lbltotrecargo-anticipo).toFixed(3);
					else
						lblsaldo.text=Number(lbltotrecargo).toFixed(3);
					
					
				}
				
				
			}
			//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			private function calcularRecargo(evt:CloseEvent):void{
				
				if ((evt.detail == Alert.NO) || (evt.detail == Alert.CANCEL)) return;
				
				calcularRecargoVariant();
				
				notas[adgNotas.selectedIndex].montototalapagar=lblTotApagar.text;
				notas[adgNotas.selectedIndex].total=lblTotGral.text;
				notas[adgNotas.selectedIndex].saldo=lblsaldo.text;
				notas[adgNotas.selectedIndex].descuentonota=lbldescuento.text;
				
				notas[adgNotas.selectedIndex].recargototal=lbltotalconrecargo.text;
			
				
				
			}
			//---------------------------------------------------------------------------------
			//}
			//----------------------------------------------------------------------------------------------------------

			protected function faultAllEmploye(event:FaultEvent):void
			{
				Alert.show("   ERROR AL OBTENER LISTADO DE EMPLEADOS   ");
				
			}
			
			protected function selFullEmploye(event:ResultEvent):void
			{
				
				xmlListEmpleados = new XMLList(event.result);				
				cmbVendedores.dataProvider=empleadoslist;
				
			}
			
			protected function group1_initializeHandler(event:FlexEvent):void
			{

				wsnotas.getRecorCountNotas();
				productosWs.searchAllProductos();
				wsempleados.selectAllEmpleados();
				wstarjetascreditodebito.searchAllTarjetasCreditoDebito();
								cmbproduct.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								txtpassword.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								mskisearchidnota.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								txtpreciop.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								cmbVendedores.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								txtdescuento.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								mskcantidad.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								mskdescuentopesos.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								mskrecargo.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								mskAnticipo.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								btnactualizarNota.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								cmbTarjetasCreditoDebito.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);
								txtNumerodeCuponPagoTarjeta.addEventListener(KeyboardEvent.KEY_UP,transferirFocus);								
								adglistpedprod.addEventListener(AdvancedDataGridEvent.ITEM_EDIT_END,itemEditEndHandler);
				initialiceVariables();				
				
			}
			protected function initialiceVariables():void{
				adgNotas.selectedIndex=0;
				totGral=0;
				totGralDesc=0;
				precio_desc=0;
				porc_d=0;
				porc_desc_total=0;
				useranulo=0;
				userEntrego=0;
				usercancelo=0;
				userexpidio=0;
				nrodocucli=0;
			}
			protected function btnRemover_clickHandler(event:MouseEvent):void
			{
				if(arrayDg.length>0&&adgNotas.selectedIndex>-1)
					Alert.show("   Esta seguro de remover los productos Listados?","Confirmar Eliminación   ", Alert.YES | Alert.NO, this, removerListadoPedidos, null, Alert.NO);
				else
					Alert.show("Debe seleccionar una fila del listado \nhaciendo click o doble click!!!");
				
			}
			private function transferirFocus(KeyPress:KeyboardEvent):void{
				
				var b:Boolean=false;
				if(KeyPress.keyCode==Keyboard.ENTER){
									if(cmbproduct.text!=""&&KeyPress.currentTarget.toString().indexOf("cmbproduct")!=-1){
										focusManager.setFocus(txtpreciop);
										txtpreciop.text=cmbproduct.selectedItem.precio;
										
									}
									
									if(KeyPress.currentTarget.toString().indexOf("cmbTarjetasCreditoDebito")!=-1&&cmbTarjetasCreditoDebito.text.length>0){
										txtNumerodeCuponPagoTarjeta.setFocus();
									}
									
									if(KeyPress.currentTarget.toString().indexOf("txtNumerodeCuponPagoTarjeta")!=-1&&txtNumerodeCuponPagoTarjeta.text.length>0){
										cmbVendedores.setFocus();
										if(chkEfectivo.selected){
											chkEfectivo.selected=false;
										}
									}
									if(KeyPress.currentTarget.toString().indexOf("cmbVendedores")!=-1&&cmbVendedores.text.length>0){
										
										txtpassword.setFocus();
									}
									if(KeyPress.currentTarget.toString().indexOf("mskcantidad")!=-1&&Number(mskcantidad.text)>0){
										for (var i:int=0;i<arrayDg.length && !b;i++){
											
											if((String(arrayDg[i].name).toUpperCase()==String(cmbproduct.text).toUpperCase()) && Number(arrayDg[i].price) != Number(txtpreciop.text)){
												Alert.show("Imposible Cargar, este Producto se encuentra cargado con un Precio diferente, corrija!!!");
												b=true;
												
											}
											
										}
										if(b.valueOf()){
											
											return;
										}else{		
											if(notas.length>0&&adgNotas.selectedIndex>-1)
												addadglistpedprod(cmbproduct.selectedItem.idproduct,adgNotas.selectedItem.id,cmbproduct.selectedItem.id,txtpreciop.text,mskcantidad.text,cmbproduct.selectedItem.descripcion,txtdescuento.text);
											else
												Alert.show("Imposible procesar, para agregar un Producto, \nantes deberá seleccionar una Nota de Pedido!!!");
										}
									}
									if(KeyPress.currentTarget.toString().indexOf("txtpreciop")!=-1&& int(txtpreciop.text)>0)
										focusManager.setFocus(mskcantidad);
									
									if(KeyPress.currentTarget.toString().indexOf("txtdescuento")!=-1 && Number(Number(txtdescuento.text).toFixed(3))>0&&arrayDg.length>0)
										Alert.show("   Desea Agregar el Descuento "+txtdescuento.text+" al Listado de Productos?","Confirmar Operación   ", Alert.YES | Alert.NO, this, calcularDescuentoTotal, null, Alert.NO);
										
										
				
									if(KeyPress.currentTarget.toString().indexOf("mskrecargo")!=-1)
										Alert.show("   Desea Agregar el Recargo % "+mskrecargo.text+" \nal porcentaje existente % "+tot_recargo_porc+" ?","Confirmar Operación   ", Alert.YES | Alert.NO, this, calcularRecargo, null, Alert.NO);
									
									if(KeyPress.currentTarget.toString().indexOf("mskAnticipo")!=-1)
										Alert.show("   Desea Agregar el Anticipo $ "+mskAnticipo.text+" \nal anticipo existente $ "+anticipo+" ?","Confirmar Operación   ", Alert.YES | Alert.NO, this, calcularAnticipo, null, Alert.NO);
										
									
												if(KeyPress.target.toString().indexOf("mskisearchidnota")!=-1){							
													indexPage=0;													
													totalReg=0;													
													last_btn.enabled=false;
													next_btn.enabled=false;
													first_btn.enabled=false;
													prev_btn.enabled=false;
													
													//metodo de webservices que busca una nota de pedido en la base de datos
													wsnotas.selectUnaNota(int(mskisearchidnota.text));
													
												}
									
									if(KeyPress.currentTarget.toString().indexOf("cmbVendedores")!=-1&&cmbVendedores.selectedItemId>=0)
										txtpassword.setFocus();
									
									if(KeyPress.currentTarget.toString().indexOf("txtpassword")!=-1&&txtpassword.text.length>0&&btnactualizarNota.enabled==true)
										btnactualizarNota.setFocus();
									
									if(KeyPress.currentTarget.toString().indexOf("mskdescuentopesos")!=-1)
										Alert.show("   Desea Agregar el Descuento en $ "+mskdescuentopesos.text+" \nal descuento existente $ "+totGralDesc+" ?","Confirmar Operación   ", Alert.YES | Alert.NO, this, calculardescuentopesos, null, Alert.NO);
										
									
									if(KeyPress.currentTarget.toString().indexOf("btnactualizarNota")!=-1&&txtpassword.text.length>0&&btnactualizarNota.enabled ==true){
										
										btnactualizarNotaEvent();
									}
								}
				
			}			
			private function calculardescuentopesos(evt:CloseEvent):void{
				if ((evt.detail == Alert.NO) || (evt.detail == Alert.CANCEL)) return;
				var b:Boolean=false;
				if(Number(Number(mskdescuentopesos.text).toFixed(3))>=0){
					for(var i:int=0;i<arrayDg.length && !b;i++){
						if(Number(arrayDg[i].porc_desc) > 0){
							b=true;
							
							Alert.show("No se puede calcular el descuento por que hay productos con descuentos en el listado!!!");
							txtdescuento.text="0.0";
							
							
						}
						
						
					}					
					if(b)
						return;					
					if(Number(porc_desc_total.toFixed(3))>0){
						Alert.show("YA HAY CALCULOS CON PORCENTAJES DE DESCUENTO, CORRIJA!!!");
						return;
					}else{
						if(Number(lblTotApagar.text)<Number(mskdescuentopesos.text)){
							Alert.show("EL CALCULO NO SE PUEDE REALIZAR, VERIFIQUE!!!");
							return;
						}else{						
							desc_resto=0;
							totGralDesc=totGralDesc+Number(mskdescuentopesos.text);			
									if(tot_recargo_porc>0){
										var calcTotalaPagar:Number=Number(totGral-totGralDesc);
										var recargoCalculo:Number=(calcTotalaPagar*tot_recargo_porc)/100;
										lbltotalconrecargo.text=Number(calcTotalaPagar+recargoCalculo).toFixed(3);
										lblTotApagar.text=Number(calcTotalaPagar+recargoCalculo).toFixed(3);
										lblsaldo.text=Number(Number(calcTotalaPagar+recargoCalculo)-anticipo).toFixed(3);	
									}else{
										desc_resto=Number(Number(lblTotGral.text)-totGralDesc);
											
										lblTotApagar.text=desc_resto.toFixed(3);
										
										lblsaldo.text=Number(desc_resto-anticipo).toFixed(3);
									}						
							lbldescuento.text=Number(-totGralDesc).toFixed(3);							
							notas[adgNotas.selectedIndex].montototalapagar=lblTotApagar.text;
							notas[adgNotas.selectedIndex].saldo=lblsaldo.text;
							notas[adgNotas.selectedIndex].descuentonota=lbldescuento.text;
							notas[adgNotas.selectedIndex].recargototal=lbltotalconrecargo.text;							
						}						
					}				
				}				
			}
			//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			//****************************************************************************************************
			protected function getDatosXML():String{
				var entregado:int=0;
				var canceladanota:int=0;
				var stockfuturo:int=0;
				var enfectivo:int=0;
				var anulada:int=0;				
				var porcdescAcum:Number=0;				
				if(txtdescuento.text.length==0)
					txtdescuento.text="0.0";
				
				if(mskrecargo.text.length==0)
					mskrecargo.text="0.0";
				
				if(mskAnticipo.text.length==0)
					mskAnticipo.text="0.0";
				
				if(mskdescuentopesos.text.length==0)
					mskdescuentopesos.text="0.0";
				
				var pendiente:int=1;
				
				if(rdbentregadosi.selected){
					entregado=1;
					pendiente=0;
				}
				
				if(rdbcanceladanotasi.selected){
					canceladanota=1;			
				}
				
				
				if(rdbAnuladasi.selected){
					anulada=1;
				}
				
				if(chkEfectivo.selected){
					enfectivo=1;
				}
					
				
				/*recorro historico para recalcular efectivamente el anticipo
				asi de esa manera nos aseguramos que no hayan problemas con los datos*/
				
				anticipo=0;
				for (var j:int=0;j<listhistoricoselected.length;j++){
					//recorro la coleccion historico para mostrar los anticipo de la nota
					if(Number(listhistoricoselected[j].anticipo)>0){					
						anticipo=anticipo+Number(Number(listhistoricoselected[j].anticipo).toFixed(3));
					}
				}
				anticipo=anticipo+Number(Number(mskAnticipo.text).toFixed(3));
				
			
				
										
										
										
										var xmlnota:String="<notapedido>\n" +
											"<idnota>"+adgNotas.selectedItem.id+"</idnota>\n" +
											"<vendedor>" +cmbVendedores.selectedItem.id+"</vendedor>\n"+
											"<personas>\n" +
												"<id>"+idcliente+"</id>\n" +
												"<numerodocu>"+nrodocucli+"</numerodocu>\n" +
											"</personas>\n" +
											"<tarjetacredito>\n" +
												"<id_tarjeta>"+cmbTarjetasCreditoDebito.selectedItem.id+"</id_tarjeta>\n" +
											"</tarjetacredito>\n" +
											"<porcentaje>\n" +
												"<id_porcentaje>1</id_porcentaje>\n" +
											"</porcentaje>\n" +
											"<montototal>"+lblTotGral.text+"</montototal>\n" +
											"<anticipo>"+mskAnticipo.text+"</anticipo>\n" +
											"<anticipoacum>"+anticipo.toFixed(3)+"</anticipoacum>\n" +
											
											"<saldo>"+lblsaldo.text+"</saldo>\n" ;
										if(entregado==1){
											xmlnota+="<entregado>"+entregado+"</entregado>\n" +
												"<id_usuario_entregado>"+cmbVendedores.selectedItem.id+"</id_usuario_entregado>\n" ;
										}else{
											xmlnota+="<entregado>"+entregado+"</entregado>\n" +
												"<id_usuario_entregado>0</id_usuario_entregado>\n" ;
										}
										
										xmlnota+="<id_usuario_expidio_nota>"+userexpidio+"</id_usuario_expidio_nota>\n" +
											"<stockFuturo>"+stockfuturo+"</stockFuturo>\n" ;
										
										if(anulada==1){
											xmlnota+="<anulado>"+anulada+"</anulado>\n" +
												"<id_usuario_anulado>"+cmbVendedores.selectedItem.id+"</id_usuario_anulado>\n" ;
										}else{
											xmlnota+="<anulado>"+anulada+"</anulado>\n" +
												"<id_usuario_anulado>0</id_usuario_anulado>\n" ;
											
										}
										if(canceladanota==1){
											xmlnota+="<cancelado>"+canceladanota+"</cancelado>\n" +
												"<id_usuario_cancelo_nota>"+cmbVendedores.selectedItem.id+"</id_usuario_cancelo_nota>\n" ;
										}else{
											xmlnota+="<cancelado>"+canceladanota+"</cancelado>\n" +
												"<id_usuario_cancelo_nota>0</id_usuario_cancelo_nota>\n" ;
										}
										
										xmlnota+="<descuentonota>"+lbldescuento.text+"</descuentonota>\n" ;
										
										if(Number(Number(mskdescuentopesos.text).toFixed(3))>0)
											xmlnota+="<descuentopesos>" +Number(mskdescuentopesos.text).toFixed(3)+"</descuentopesos>\n";
										else
											xmlnota+="<descuentopesos>0</descuentopesos>\n";
										
											xmlnota+="<porcentajerecargo>"+tot_recargo_porc+"</porcentajerecargo>\n" +
											"<montototalapagar>"+lblTotApagar.text+"</montototalapagar>\n"+
											"<observaciones>" +this.txtobservaciones.text+"</observaciones>\n" +
											"<pendiente>"+pendiente+"</pendiente>\n"+
											"<montoiva>0</montoiva>\n"+
											"<recargo>"+lbltotalconrecargo.text+"</recargo>\n" +
											"<fechacompra>"+notas[adgNotas.selectedIndex].fechacompra+"</fechacompra>\n"+					
											"<fechaentrega>"+notas[adgNotas.selectedIndex].fechaentrega+"</fechaentrega>\n"+
											"<fecancel>"+notas[adgNotas.selectedIndex].fecancel+"</fecancel>\n"+					
											"<horacompra>"+notas[adgNotas.selectedIndex].horacompra+"</horacompra>" +
											"<fechaanulada>"+notas[adgNotas.selectedIndex].fechaanulado+"</fechaanulada>\n"+
											"<numerodecupon>"+txtNumerodeCuponPagoTarjeta.text+"</numerodecupon>\n" +
											"<enefectivo>"+enfectivo+"</enefectivo>\n"+
											"<enefectivoAnticipo>"+enfectivo+"</enefectivoAnticipo>\n"+
											"<detallesnotapedido>\n" ;
										
													for(var ii:int=0;ii<arrayDg.length;){
														
														if(arrayDg[ii].price==0||arrayDg[ii].countt==0||arrayDg[ii].subtotal==0)
															ii++;
															else{
																	porcdescAcum+=Number(Number(arrayDg[ii].porc_desc).toFixed(2));
																	xmlnota+="<itemdetallesnota>\n" +
																		"<cantidad>"+arrayDg[ii].countt+"</cantidad>\n" +
																			"<preciocondescuento>"+arrayDg[ii].prec_descuento+"</preciocondescuento>\n" +
																			"<precio>"+arrayDg[ii].price+"</precio>\n" +
																			"<subtotal>"+Number(arrayDg[ii].subtotal).toFixed(3)+"</subtotal>\n" +									
																			"<entregado>"+entregado+"</entregado>\n" +
																			"<cancelado>"+canceladanota+"</cancelado>\n" +
																			"<anulado>"+anulada+"</anulado>\n" +
																			"<pendiente>"+pendiente+"</pendiente>\n" ;
																	if(desc_resto>0&&Number(arrayDg[ii].porc_desc)>0)
																			xmlnota+="<descuento>0.00</descuento>\n" ;
																	else
																			xmlnota+="<descuento>"+Number(arrayDg[ii].porc_desc).toFixed(2)+"</descuento>\n" ;
																			xmlnota+="<iva>0</iva>\n" +
																			"<id_nota>"+arrayDg[ii].idnota+"</id_nota>\n" +
																			"<id_producto>"+arrayDg[ii].id+"</id_producto>\n" +
																			"</itemdetallesnota>\n" ;
																		ii++
																}								
													}
										
										
										
										xmlnota+= "</detallesnotapedido>\n" ;
											if(porcdescAcum>0)
												xmlnota+="<porc_descuento_total>"+Number(porcdescAcum).toFixed(2)+"</porc_descuento_total>\n" ;
											else
												xmlnota+="<porc_descuento_total>"+Number(txtdescuento.text).toFixed(2)+"</porc_descuento_total>\n" ;
											
										
										return xmlnota+="</notapedido>\n";
										
				//}				
										
			}
			//****************************************************************************************************
			private function addadglistpedprod(idprod:String,codigoId:String,idnota:String,txtprecio:String,cantidad:String,descripcion:String,desc_porc:String):void{
				
				var subtot:Number;
				var b:Boolean=false;
				var p_desc:Number=0;
				
				arrayDg.refresh();
				subtot=Number(Number(Number(Number(txtprecio).toFixed(3))*Number(cantidad)).toFixed(3));
				totGral=Number(Number(totGral.toFixed(3))+Number(subtot.toFixed(3)));
				
				
				
				
				if(dp.length==0){
					dp=[{idproduct:idprod,id:idnota,name:descripcion,countt:cantidad,price:txtprecio,porc_desc:"0.000",prec_descuento:p_desc,subtotal:subtot,idnota:codigoId}];
					totGralDesc=totGralDesc+Number(Number(desc_porc).toFixed(3));
				}else{
					
					for(var i:int=0;i<dp.length && !b;i++){	
						
						//------------------------------------------------------------------					
						if(dp[i].name==descripcion){
							
							dp[i].countt=int(dp[i].countt)+int(cantidad);					
							dp[i].subtotal=dp[i].subtotal+subtot-p_desc;
							
							
							b=true;
							
						}
						//------------------------------------------------------------------
					}
					if(!b)					
						dp.push({idproduct:idprod,id:idnota,name:descripcion,countt:cantidad,price:txtprecio,porc_desc:"0.000",prec_descuento:p_desc,subtotal:subtot,idnota:codigoId});
					
				}
				
				//-------------------------------------------------------------------------		
				arrayDg.source=dp;
				arrayDg.refresh();
				//-------------------------------------------------------------------------
				btnRemover.enabled=true;
				
				adglistpedprod.dataProvider=arrayDg;
				lblTotGral.text=totGral.toFixed(3);
				lbldescuento.text=Number(-totGralDesc).toFixed(3);
				
				if(int(mskrecargo.text)>0){
					
					var calcularTotalAPagar:Number=totGral-totGralDesc;
					
					var recargo:Number=tot_recargo_porc*Number(calcularTotalAPagar.toFixed(3))/100;
					lbltotalconrecargo.text=Number(Number(calcularTotalAPagar.toFixed(3))+recargo).toFixed(3);
					lblTotApagar.text=Number(Number(calcularTotalAPagar.toFixed(3))+recargo).toFixed(3);
					lblsaldo.text=Number(Number(Number(totGral)-Number(totGralDesc))+recargo-anticipo).toFixed(3);
					
				}else{
					lblTotApagar.text=Number(Number(totGral)-Number(totGralDesc)).toFixed(3);
					lblsaldo.text=Number(Number(totGral)-Number(totGralDesc)-anticipo).toFixed(3);
					
				}
				
		
				
					
				
				
				
				mskcantidad.text="";
				txtpreciop.text="";
				
				
					notas[adgNotas.selectedIndex].montototalapagar=lblTotApagar.text;
					notas[adgNotas.selectedIndex].total=lblTotGral.text;
					notas[adgNotas.selectedIndex].saldo=lblsaldo.text;
					notas[adgNotas.selectedIndex].descuentonota=lbldescuento.text;
						
					notas[adgNotas.selectedIndex].recargototal=lbltotalconrecargo.text;
				
				cmbproduct.setFocus();
				
			}
			//--------------------------------------------------------------------------------------
			//---------------------------------------------------------------------------------
			private function calcularDescuentoTotal(evt:CloseEvent):void{
				
				var b:Boolean=false;
				
				if ((evt.detail == Alert.NO) || (evt.detail == Alert.CANCEL)) return;
				
				
				for(var i:int=0;i<arrayDg.length && !b;i++){
					if(Number(arrayDg[i].porc_desc) > 0){
						b=true;
						
						Alert.show("No se puede calcular el descuento por que hay productos con descuentos en el listado!!!");
						txtdescuento.text="0.0";
						
						
					}
					
					
				}
				
				if(b)
					return;
				
				if(desc_resto==0)			
					calcularDescuentoVariant();
				else{
					Alert.show("YA HAY CALCULADO UN DESCUENTO EN\n PESOS, IMPOSIBLE REALIZAR LA OPERACIÓN!!!");
					return;
				}
				
				
				
				
					
				
				notas[adgNotas.selectedIndex].montototalapagar=lblTotApagar.text;
				notas[adgNotas.selectedIndex].total=lblTotGral.text;
				notas[adgNotas.selectedIndex].saldo=lblsaldo.text;
				notas[adgNotas.selectedIndex].descuentonota=lbldescuento.text;
				notas[adgNotas.selectedIndex].recargototal=lbltotalconrecargo.text;
				
			}
			
			protected function calcularDescuentoVariant():void{
				var tot_desc:Number=0;
				var por_des_tot:Number=0;
				
				if(int(totGralDesc)>0){
					
					por_des_tot=Number(Number(txtdescuento.text).toFixed(2));
					porc_desc_total=Number(por_des_tot.toFixed(2));							
					tot_desc= Number(Number(lblTotGral.text).toFixed(3))*por_des_tot/100;						
					lbldescuento.text=Number(Number(-tot_desc)).toFixed(3);
					totGralDesc=Number(lbldescuento.text);
					
				}else
					lbldescuento.text="0.000";
				
				
				var calcrecargo:Number=Number(totGral-totGralDesc)*tot_recargo_porc/100;
				
				if(Number(tot_recargo_porc.toFixed(3))>Number("0.0")){
					
					lbltotalconrecargo.text=Number(Number(totGral)-totGralDesc+(calcrecargo)).toFixed(3);
					lblTotApagar.text=Number(Number(totGral)-totGralDesc+(calcrecargo)).toFixed(3);
					lblsaldo.text=Number(Number(Number(totGral)-totGralDesc+(calcrecargo))-anticipo).toFixed(3);
					
				}else{
					lblTotApagar.text=Number(Number(totGral)-tot_desc).toFixed(3);
					lblsaldo.text=Number(Number(Number(totGral)-totGralDesc)-anticipo).toFixed(3);
				}
				
				
			}
			
			
			//-------------------------------------------------------------------------------------
			
			//---------------------------------------------------------------------------------
			//--------------------------------------------------------------------------------------
			public function removerListadoPedidos(cls:CloseEvent):void{
				
				
				if ((cls.detail == Alert.NO) || (cls.detail == Alert.CANCEL)) return;
				//----------------------------------------------------------
				adglistpedprod.dataProvider.removeItems();
				arrayDg.removeAll();
				arrayDg.refresh();
				adgNotas.dataProvider=notas;	
				
				
				//----------------------------------------------------------
				totGral=0;
				totGralDesc=0;
				precio_desc=0;
				txtdescuento.text="0.0";
				cmbproduct.text="";
				cmbproduct.setFocus();
				txtpreciop.text="";
				mskcantidad.text="";
				mskrecargo.text="0.0";
				mskAnticipo.text="0";
				mskdescuentopesos.text="0.0";
				mskAnticipo.text="0.0";
				btnRemover.enabled=false;
				lblTotApagar.text="0.000";
				lblTotGral.text="0.000";
				porc_d=0;
				porc_desc_total=0;
				lbldescuento.text="0.000";
				lbltotalconrecargo.text="0.000";
				lblsaldo.text="0.000";
				desc_resto=0;
				tot_recargo_porc=0;
				anticipo=0;
				useranulo=0;
				
				userEntrego=0;
				usercancelo=0;
				userexpidio=0;
				nrodocucli=0;
				
				
				
				//--------------------------------------------------------
				
				
				
			}
			protected function brncargarunproducto_clickHandler(event:MouseEvent):void
			{
				var indice:Number=0;
				var popup:DatosProducto=DatosProducto(PopUpManager.createPopUp(this,DatosProducto,true));
				
				popup.product=productlist;
				
				
				
				
				PopUpManager.centerPopUp(popup);
			}
			protected function faultSearchAllProducts(event:FaultEvent):void
			{
				Alert.show("Error al Conectar al Servidor!!!");
				
			}
			protected function operationResultSearchAllProduct(event:ResultEvent):void
			{
				
				if(String(event.result.toString())=="LA CONSULTA NO ARROJÓ RESULTADOS")
					Alert.show("LA CONSULTA NO ARROJÓ RESULTADOS");
				else{
					if(String(event.result.toString())=="NADA"){
						Alert.show("   FALLÓ LA CONEXION CON LA BASE DE DATOS, REVISE LOS SERVICIOS SI SE HAN INICIADO CORRECTAMENTE.   ");
					}else{
						xmlproduct=new XMLList(event.result);							
						cmbproduct.dataProvider=productlist;						
					}
				}
				
				
				
				
			}
			//--------------------------------------------------------------------------
			protected function adglistpedprod_itemDoubleClickHandler(event:mx.events.ListEvent):void
			{
				// TODO Auto-generated method stub
				
				Alert.show("   Está seguro de eliminar el Registro actual?","Confirmar Eliminación   ", Alert.YES | Alert.NO, this, delRowHandler, null, Alert.NO);
				
				
			}
			//--------------------------------------------------------------------------------------
			protected function delRowHandler(evt:CloseEvent):void{
				var desc_parcial:Number=0;
				var recargo:Number=0;
				var tempTotDesc:Number=0;
				var tempPorcDes:Number=0;
			
				//----------------------------------------------------------------------------------
				
				
				if ((evt.detail == Alert.NO) || (evt.detail == Alert.CANCEL)) return;			
				
				//---------------------------------------------------------------------------------	
				
				
				
				
				
				
				//---------------------------------------------------------------------------------Controlo los descuentos y totales gral
				
				var totgrilla:Number=0;
				for(var k:int=0;k<arrayDg.length;k++){
					
					if(arrayDg[k].idproduct!=adglistpedprod.selectedItem.idproduct){
						
							tempTotDesc=tempTotDesc+Number(arrayDg[k].prec_descuento);
							tempPorcDes=tempPorcDes+Number(arrayDg[k].porc_desc);
						
						
							totgrilla=totgrilla+(arrayDg[k].price*arrayDg[k].countt);	
						
					}
					
					
				}
				
				
				
			if(Number(mskdescuentopesos.text)==0){
				totGral=totgrilla;
				totGralDesc=Number(totGralDesc.toFixed(3))-Number(Number(adglistpedprod.selectedItem.prec_descuento).toFixed(3));
				porc_desc_total=porc_desc_total-Number(adglistpedprod.selectedItem.porc_desc);
				
				
				//---------------------------------------------------------------------------------	
				
				
				
				
				
				
				
				
				
										//-------------------------------------------------------------------------------
										
										if(arrayDg.length==0){
											
											totGral=0;
											totGralDesc=0;
											precio_desc=0;
											txtdescuento.text="0.000";
											useranulo=0;
											userEntrego=0;
											usercancelo=0;
											userexpidio=0;
											txtpreciop.text="";
											mskcantidad.text="";
											mskrecargo.text="0.0";
											btnRemover.enabled=false;
											lblTotApagar.text="0.000";
											lblTotGral.text="0.000";
											mskAnticipo.text="0.0";
											mskdescuentopesos.text="0.0";
											
											mskrecargo.text="0.000";
											porc_d=0;
											porc_desc_total=0;		
											lbldescuento.text="0.000";
											lbltotalconrecargo.text="0.000";
											lblsaldo.text="0.000"
											desc_resto=0;
											
											nrodocucli=0;
											anticipo=0;
											tot_recargo_porc=0;
											temp_tot_porc_desc=0;
											tempPorcDes=0;
											tempTotDesc=0;
											totRecargo=0;
											notas[adgNotas.selectedIndex].saldo="0.000";
											
											notas[adgNotas.selectedIndex].recargototal="0.000";
											notas[adgNotas.selectedIndex].montototalapagar="0.000";
											notas[adgNotas.selectedIndex].total="0.000";
											
											notas[adgNotas.selectedIndex].descuentonota="0.000";
											
										}else
											ereaseDellRow(recargo);
											
			
												
												
											
										
			}else
				ereaseDellRow(recargo);
			
				
				//------------------------------------------------------------------------------
				adglistpedprod.dataProvider.removeItemAt(adglistpedprod.selectedIndex);				
				arrayDg.refresh();
				notas.refresh();
				cmbproduct.setFocus();
				//------------------------------------------------------------------------------
				
				
			}
			//--------------------------------------------------------------------------------------
			protected function ereaseDellRow(recargo:Number):void{
					//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
				var calcularTotalAPagar:Number=totGral-totGralDesc;
				
				
				
				recargo=tot_recargo_porc*Number(calcularTotalAPagar.toFixed(3))/100;
				
				lblTotGral.text=totGral.toFixed(3);
				lbldescuento.text=Number(-totGralDesc).toFixed(3);
				
				
				if(recargo==0){
					lbltotalconrecargo.text="0.000";					
					notas[adgNotas.selectedIndex].recargototal="0.000";
					lblTotApagar.text=Number(Number(totGral-totGralDesc)).toFixed(3);				
					
					
					lblsaldo.text=Number(Number(totGral-totGralDesc)-anticipo).toFixed(3);
					
				}else{
					
					lbltotalconrecargo.text=Number(Number(totGral-totGralDesc)+(recargo)).toFixed(3);
					lblTotApagar.text=Number(Number(totGral-totGralDesc)+(recargo)).toFixed(3);
					lblsaldo.text=Number(Number(totGral-totGralDesc)+(recargo)-anticipo).toFixed(3);
					
				}
				
				
				notas[adgNotas.selectedIndex].montototalapagar=Number(Number(totGral-Number(totGralDesc.toFixed(3)))+Number(recargo.toFixed(3))).toFixed(3);
				notas[adgNotas.selectedIndex].total=totGral.toFixed(3);	
				notas[adgNotas.selectedIndex].descuentonota=Number(-totGralDesc).toFixed(3);
				notas[adgNotas.selectedIndex].recargototal=Number(Number(totGral-Number(totGralDesc.toFixed(3)))+Number(recargo.toFixed(3))).toFixed(3);
				notas[adgNotas.selectedIndex].saldo=Number(Number(totGral-Number(totGralDesc.toFixed(3)))+Number(recargo.toFixed(3))-anticipo).toFixed(3);
				
				
					//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
			
			
			}
			
			protected function operation4_resultHandler(event:ResultEvent):void
			{
				
				xmltarjetas=new XMLList(event.result);
				cmbTarjetasCreditoDebito.dataProvider=tarjetas;
				
			}
			
			protected function operation4_faultHandler(event:FaultEvent):void
			{
				Alert.show("ERROR AL OBTENER LAS TARJETAS DE DEBITO");
				
			}
			
			protected function btnRegargarlistado_clickHandler(event:MouseEvent):void
			{
				wsnotas.getRecorCountNotas();
				
			}
			
			protected function operationSelectOneNota(event:ResultEvent):void
			{
				
				if(event.result.toString().indexOf("Error no paso nada")!=-1){
					Alert.show("LA CONSULTA NO ARROJÓ RESULTADOS!!!");
				}else{
					if(event.result.toString().indexOf("nota no encontrada")!=-1){
						Alert.show("NOTA DE PEDIDO NO ENCONTRADA!!!");
					}else{
						if(event.result.toString().indexOf("No se puede realizar la operacion de Actualizacion o Borrado")!=-1){
							Alert.show("NO SE PUEDE REALIZAR\n LA OPERACION DE ACTUALIZACIÓN O BORRADO!!!");
						}else{
							xmlNotas=new XMLList(event.result);
							addgrid();
							btnRegargarlistado.enabled=true;
							limpiarGrids();
							limpiarControlesVarios();
							adgNotas.selectedIndex=0;
							adgNotas.validateNow();
							addinfo();
						}
						
					}
				}
			}
			
			protected function operationOneNotaFault(event:FaultEvent):void
			{
				Alert.show("Error al recargar notas de pedido");
				
			}
			protected function btnImprimir_clickHandler(event:MouseEvent):void
			{
				
				if(adgNotas.selectedItem.id>0){
					
					var source:String="http://192.168.1.101:8080/WebMelanie2/ShowReportNotaPedido?nronota="+adgNotas.selectedItem.id;
					
					var urlReq:URLRequest= new URLRequest(source);
					navigateToURL(urlReq,"_blank");
				}else
					Alert.show("DEBE SELECCIONAR UNA NOTA DE PEDIDO");
			
				
			}
			//----------------------------------------------------------------------------
			protected function verificoVendedorConSuPassword():Boolean{
			var b:Boolean=false;
				
				
					
					for(var i:int=0;i<empleadoslist.length;i++){
						if(cmbVendedores.selectedItem.nameuser==empleadoslist[i].nameuser&&txtpassword.text==empleadoslist[i].clave){
							b=true;
							break;
						}
						
						
					}
					
					if(b)
						return true;
					else
						Alert.show("Datos Incorrectos!");
				
				
			return b;
			}
			protected function btnguardarentregada_clickHandler(event:MouseEvent):void
			{
				var b:Boolean=false;
				
				
								if(adgNotas.selectedItem.id>0){
										if(int(notas[adgNotas.selectedIndex].entregado)==1&&rdbentregadosi.selected==true){
											Alert.show("LA NOTA DE PEDIDO "+notas[adgNotas.selectedIndex].id+" YA FUE ENTREGADA");
										}else{
											if(verificarEntregaNoCancelada()){
											  if(cmbVendedores.text.length==0||txtpassword.text.length==0){
													Alert.show("Debe seleccionar un vendedor con su clave!");  
											  }else{
														if(verificoVendedorConSuPassword()){
																	wsnotas.entregarNotaPedido(getDatosXML(),1);
														}else{						
																if(rdbentregadono.selected==true){
																	if(verificoVendedorConSuPassword())
																		wsnotas.entregarNotaPedido(getDatosXML(),0);
																}
														}
											  }
											}
										}
								}else{
									Alert.show(" Debe seleccionar una nota en la grilla ");
								}
				
				
					
					
					
			}
			
			protected function verificarEntregaNoCancelada():Boolean{
				if(rdbentregadosi.selected==true&&int(notas[adgNotas.selectedIndex].cancelado)==0){
						Alert.show("No se puede entregar una nota de pedido que no está cancelada o saldada!");	
						return false;
				}else{
					return true;
				}			
			}
			protected function operacionEntregarNotaHandler(event:ResultEvent):void
			{var result:int=event.result.toString();
				cmbVendedores.text="";
				txtpassword.text="";
				
				switch(result)
				{
					case -1:
					{
						Alert.show("ERROR EN EL SERVIDOR, VERIFIQUE");
						break;
					}
						case 0:{
							Alert.show("NOTA YA ENTREGADA");
							wsnotas.getRecorCountNotas();
							
							break;
						}
						
					default:
					{
						Alert.show("NOTA "+result+" MODIFICADO ESTADO ENTREGADO");
						
						
						wsnotas.getRecorCountNotas();
						break;
					}
				}
				
			}
			
			protected function operacionFaultEntregaNotaHandler(event:FaultEvent):void
			{
				Alert.show("   ERROR AL EJECUTAR ENTREGA DE NOTA DE PEDIDO   ");
			}
			
			protected function anularHandler(event:ResultEvent):void
			{
				var numeroNotaAnulada:int=event.result.toString();
				cmbVendedores.text="";
				txtpassword.text="";
				switch(numeroNotaAnulada)
				{
					case -1:
					{
						Alert.show("Error al anular nota de pedido, verifique");
						break;
					}
					case 0:
					{
						Alert.show("La nota ya fue anulada!");
						break;
					}						
					default:
					{
						Alert.show("NOTA DE PEDIDO "+numeroNotaAnulada+" CAMBIO DE ESTADO\n                         ANULADO");
						wsnotas.getRecorCountNotas();
						break;
					}
				}
				
			}
			
			protected function anularFaultHandler(event:FaultEvent):void
			{
				Alert.show("Error al anular nota de pedido");
			}
			
			protected function cancelarHandler(event:ResultEvent):void
			{
				var cancelado:int=event.result.toString();
				cmbVendedores.text="";
				txtpassword.text="";
				switch(cancelado)
				{
					case -1:
					{
					Alert.show("Error al cancelar nota verifique!");
						break;
					}
					case 0:
					{
						Alert.show("La nota ya fue cancelada!");
						break;
					}
					case -3:
					{
						Alert.show("La nota no está saldada aún!");
						break;
					}
						
					default:
					{
						Alert.show("   NOTA DE PEDIDO "+cancelado+" CAMBIO DE ESTADO CACELADO   ");
						wsnotas.getRecorCountNotas();
						break;
					}
				}
				
			}
			
			protected function cancelarHandlerFault(event:FaultEvent):void
			{
				Alert.show("Error al cancelar nota de pedido");
			}
			
			protected function buttonCancelarHandler(event:MouseEvent):void
			{
				if(int(notas[adgNotas.selectedIndex].cancelado)==1&&rdbcanceladanotasi.selected==true){
					Alert.show("LA NOTA DE PEDIDO "+notas[adgNotas.selectedIndex].id+" YA FUE CANCELADA");
				}else{				
					if(int(lblsaldo.text)>0){
						Alert.show("   La nota "+notas[adgNotas.selectedIndex].id+" no está saldada!!!");
					}else{
						tratarCancelaNota();
					}
				}
			}
				
			protected function tratarCancelaNota():void{
				var b:Boolean=false;				
				
				if(adgNotas.selectedItem.id>0){
					if(int(notas[adgNotas.selectedIndex].anulado)==1){
						Alert.show("LA NOTA DE PEDIDO "+notas[adgNotas.selectedIndex].id+" ESTÁ ANULADA CAMBIE DE ESTADO PARA PODER CANCELAR Y/O ENTREGAR");
					}else{
						if(cmbVendedores.text.length==0||txtpassword.text.length==0){
							Alert.show("Debe seleccionar un vendedor y poner su clave!");
						}else{
							if(rdbcanceladanotasi.selected==true){
								if(verificoVendedorConSuPassword()){
										if(verificarSeleccionComboTarjetaYNumero()()){
										
										}
										wsnotas.cancelarNotaPedido(getDatosXML(),1);									
								}else{						
									if(rdbcanceladanotano.selected==true){
										if(verificoVendedorConSuPassword()){
											wsnotas.cancelarNotaPedido(getDatosXML(),0);
										}
									}
								}
							}
						}
					}
				}else{
					Alert.show("Debe seleccionar una nota en la grilla");
				}
			}
		/*			if(int(notas[adgNotas.selectedIndex].anulado)==1){
						Alert.show("LA NOTA DE PEDIDO "+notas[adgNotas.selectedIndex].id+" ESTÁ ANULADA CAMBIE DE ESTADO PARA PODER CANCELAR Y/O ENTREGAR");
					}else{						
							if(cmbVendedores.text.length==0||txtpassword.text.length==0){
								Alert.show("Debe seleccionar un vendedor y poner su clave!");
							}else{
											if(rdbcanceladanotasi.selected==true){
														if(verificoVendedorConSuPassword()){
																	if(Number(mskAnticipo.text)>0||anticipo>0){
																		calculeAnticipo();	
																	}else{
																		wsnotas.cancelarNotaPedido(adgNotas.selectedItem.id,cmbVendedores.selectedItem.id,1,anticipo);
																	}
														}else{						
															if(rdbcanceladanotano.selected==true){
																		if(verificoVendedorConSuPassword()){
																			wsnotas.cancelarNotaPedido(adgNotas.selectedItem.id,cmbVendedores.selectedItem.id,0,anticipo);
																		}
															}
													}
											}
				
				}else{
					  Alert.show("Debe seleccionar una nota en la grilla");
				}
			}*/
			protected function buttonAnularHandler(event:MouseEvent):void
			{
				var b:Boolean=false;
				
				
				if(adgNotas.selectedItem.id>0){
					if(int(notas[adgNotas.selectedIndex].anulado)==1&&rdbAnuladasi.selected==true){
						Alert.show("LA NOTA DE PEDIDO "+notas[adgNotas.selectedIndex].id+" YA FUE ANULADA!");
					}else{
						if(cmbVendedores.text.length==0||txtpassword.text.length==0){
							Alert.show("Debe seleccionar un vendedor y poner su clave!"); 
						}else{
								if(rdbAnuladasi.selected==true){
									if(verificoVendedorConSuPassword())
										wsnotas.anularNotaPedido(getDatosXML(),1);
								}else{						
									if(rdbAnuladano.selected==true){
										if(verificoVendedorConSuPassword())
											wsnotas.anularNotaPedido(getDatosXML(),0);
									}
								}
						}
					}
				}else
					Alert.show("Debe seleccionar una nota en la grilla");
				
			}
			
			protected function actualizarHandlerNota(event:ResultEvent):void
			{
				var result:int=int(event.result.toString());
				PopUpManager.removePopUp(popup);
				
				switch(result)
				{
					case 0:
					{
						Alert.show("NO PASO NADA VERIFIQUE!!!");	
						break;
					}
					case -1:
					{
						Alert.show("  ERROR EN EL SERVIDOR AL actualizarNota NOTA DE PEDIDO  ");
						break;
					}
					case -2:
					{
						Alert.show("NOTA DE PEDIDO NO ENCONTRADA");
						break;
					}
					case -3:
					{
						Alert.show("NO PASO NADA VERIFIQUE!!!");
						break;
					}
					case -4:
					{
						Alert.show("  ERROR EN EL SERVIDOR AL PROCESAR NOTA DE PEDIDO  ");
						break;
					}	
					case -5:{
						Alert.show("  ERROR DATOS NO ENVIADOS PARA ACTUALIZAR   ");
						break;
					}	
					case -10:{
						Alert.show("  LA NOTA DE PEDIDO YA SE ENCUENTRA ANULADA   ");
						break;
					}	
					case -11:{
						Alert.show("  LA NOTA DE PEDIDO YA SE ENCUENTRA ENTREGADA   ");
						break;
					}
					case -12:{
						Alert.show("  LA NOTA DE PEDIDO YA SE ENCUENTRA CANCELADA   ");
						break;
					}
					case -13:{
						Alert.show("  LA NOTA DE PEDIDO TIENE QUE ESTAR CANCELADA O SALDADA ANTES DE SER ENTREGADA   ");
						break;
					}	
						
					default:
					{
						Alert.show("NOTA DE PEDIDO ACTUALIZADA "+result);
						wsnotas.getRecorCountNotas();
						limpiarControles();
						break;
					}
				}
				
				
				
			}
			
			protected function falloActualizarHandlerNota(event:FaultEvent):void
			{
				PopUpManager.removePopUp(popup);
				Alert.show("Error al actualizarNota "+event.fault.toString());
			}
			protected function btnactualizarNotaEvent():void{				
				
				if(!verificarSeleccionComboTarjetaYNumero()){
								if(verificarEntregaNoCancelada()){
												if((int(notas[adgNotas.selectedIndex].entregado)==1&&rdbentregadosi.selected==true)){
													Alert.show("LA NOTA DE PEDIDO "+notas[adgNotas.selectedIndex].id+" YA FUE ENTREGADA!");
												}else{									
														if(int(notas[adgNotas.selectedIndex].anulado)==1&&rdbAnuladasi.selected==true){
															Alert.show("LA NOTA DE PEDIDO "+notas[adgNotas.selectedIndex].id+" YA FUE ANULADA!");
														}else{
														if(String(notas[adgNotas.selectedIndex].fechaentrega).length>0){
															
															if(String(notas[adgNotas.selectedIndex].fechacompra).length>0){
																
																if(adgNotas.selectedIndex>-1&&idnota==int(notas[adgNotas.selectedIndex].id)){
																	if(txtpassword.text.length>0){
																		
																		Alert.show("   Desea Guardar Nota De Pedido Actual?","Confirmar Operación  ", Alert.YES | Alert.NO, this, actualizarNota, null, Alert.NO);
																		
																		
																	}else{
																		Alert.show("El password del empleado no es correcto");
																	}
																}else{
																	Alert.show("SELECCIONE LA NOTA CORRESPONDIENTE");
																}
															}else{
																Alert.show("Falta la fecha de compra");
															}
														}else{
															Alert.show("Falta la fecha de entrega");
														}
													}								
												}
								}
			
					}else{
						Alert.show("Falta seleccionar Tarjeta de Crédito, numero de cupón o cambiar estado de anticipo en efectívo!");	
					}
			}
			protected function verificarSeleccionComboTarjetaYNumero():Boolean{
				
				if(cmbTarjetasCreditoDebito.selectedItemId!=0&&txtNumerodeCuponPagoTarjeta.text.length>0&&chkEfectivo.enabled==false){
					
					return true;
				}else{
					
					return false;
				}
			}
			protected function btnactualizarNota_clickHandler(evt:MouseEvent):void
			{
				
							btnactualizarNotaEvent();
				
			}
			
			protected function actualizarNota(evt:CloseEvent):void
			{
				
				if ((evt.detail == Alert.NO) || (evt.detail == Alert.CANCEL)) return;
				
				if(arrayDg.length>0){
					popup=Progress(PopUpManager.createPopUp(this,Progress,true));
					PopUpManager.centerPopUp(popup);
					
					
					wsnotas.actualizarNotaPedido(getDatosXML());
				
					
				
				}
				
				
			}
			private function limpiarGrids():void{
				//----------------------------------------------------------
				detallenotasList.removeAll();
				
				adglistpedprod.dataProvider.removeItems();
				
				adghistorico.dataProvider.removeAll();
				
				arrayDg.removeAll();
				arrayDg.refresh();
				listhistorico.removeAll();
				
				//----------------------------------------------------------
			
			}
			private function limpiarControlesVarios():void{
				totGral=0;
				txtpreciop.text="";
				mskdocumento.text="";
				lblexpidiovendedor.text="";
				lblnombreyapecli.text="";
				lblvendedocancelo.text="";
				lblvendedoranulo.text="";
				lblvendedorentrego.text"";
				mskrecargo.text="";				
				totGralDesc=0;
				precio_desc=0;
				txtdescuento.text="0.0";				
				mskrecargo.text="0.0";
				mskdescuentopesos.text="0.0";
				mskAnticipo.text="0.0";
				mskcantidad.text="";			
				txtobservaciones.text="";
				nrodocucli=0;
				btnRemover.enabled=false;
				btnEliminarNota.enabled=false;
				useranulo=0;
				userEntrego=0;
				usercancelo=0;
				userexpidio=0;
				
				lblTotApagar.text="0.000";
				lblTotGral.text="0.000";
				porc_d=0;
				porc_desc_total=0;
				lbldescuento.text="0.000";
				lbltotalconrecargo.text="0.000";
				lblsaldo.text="0.000";
				desc_resto=0;
				tot_recargo_porc=0;
				anticipo=0;
				totRecargo=0;
				txtpassword.text="";
				cmbTarjetasCreditoDebito.selectedItemId=0;
				cmbVendedores.text="";
				txtpassword.text="";
				if(btnactualizarNota.enabled == true){
					btnactualizarNota.enabled = false;
				}
			}
			protected function limpiarControles():void{
				limpiarGrids();
				limpiarControlesVarios();
				cmbproduct.text="";
				cmbproduct.setFocus();
				txtpreciop.text="";
				mskisearchidnota.text="";
				
				
				
				
				
			
			
			}
			//*************************************************************************************++
			protected function btnCloseClientComponent_clickHandler(event:MouseEvent):void
			{
				this.removeAllElements();	
			}
			//*************************************************************************************++
			
			protected function adgNotas_clickHandler(event:MouseEvent):void
			{
				addinfo();
			}
			protected function result_deleteNote(event:ResultEvent):void{
				var retorno:int=int(event.result.toString());
				
				switch(retorno)
				{
					case 0:
					{
						Alert.show("NO PASO NADA");
						break;
					}
					case -2:
					{
						Alert.show("NOTA DE PEDIDO NO ENCONTRADA EN LA BASE DE DATOS");
						break;
					}
					case -1:
					{
						Alert.show("ERROR AL ELIMINAR NOTA DE PEDIDO");	
						break;
					}	
						
					default:
					{
						Alert.show("NOTA DE PEDIDO ELIMINADA DE LA BASE DE DATOS");
						limpiarControles();
						wsnotas.getRecorCountNotas();
						break;
					}
				}
				
				
			
			}
			protected function fault_deleteNote(event:FaultEvent):void{
				
				Alert.show("Se produjo un error al eliminar nota de pedido verifique!!!");
			
			}
			
			protected function btn_delete_One_OrderForm(event:MouseEvent):void
			{
				if(cmbVendedores.selectedItemId>0){
					if(txtpassword.text.length>0){
							if(cmbVendedores.selectedItem.clave==txtpassword.text){
								if(adgNotas.selectionLength>0)
									Alert.show("Desea eliminar la nota de pedido N° "+notas[adgNotas.selectedIndex].id,"Confirmar Eliminación   ", Alert.YES | Alert.NO, this, delNoteRow, null, Alert.NO);
								else
									Alert.show("Debe seleccionar una nota de pedido\n para realizar la operación")
							}else
								Alert.show("Clave incorrecta!");
					}else
						Alert.show("Debe ingresar clave del vendedor!");
				}else
					Alert.show("Debe seleccionar un Empleado");
			}
			protected function delNoteRow(cls:CloseEvent):void{
				if ((cls.detail == Alert.NO) || (cls.detail == Alert.CANCEL)) return;
				var idnota:int=notas[adgNotas.selectedIndex].id;
				var idEmpleado:int=cmbVendedores.selectedItem.id;
				wsnotas.eliminarNotaDePedido(idnota,idEmpleado);
			
			}
			
			protected function txtpassword_enterHandler(event:FlexEvent):void
			{
				if(txtpassword.text.length>0){
					event.preventDefault();
					chkpassEmployee();
					
				}
			}
			public function chkpassEmployee():Boolean{
				return wsempleados.checkPassEmployee(cmbVendedores.selectedItem.id,txtpassword.text);
				
			}
			
			
			protected function checkPassHandlerEmployee(event:ResultEvent):void
			{
				var chkpasswordEmployeee:String = event.result.toString();
				
				switch(chkpasswordEmployeee)
				{
					case "false":
					{
						Alert.show("Clave de vendedor incorrecta.");
						if(btnactualizarNota.enabled==true){
							btnactualizarNota.enabled=false;
						}
						break;
					}
					case "Empleado no encontrado":
					{
						Alert.show("Empleado no encotrado.");
						if(btnactualizarNota.enabled==true){
							btnactualizarNota.enabled=false;
						}
						break;
					}
					
					default:
					{
						if(btnactualizarNota.enabled==false){
							btnactualizarNota.enabled=true;
						}
							
						break;
					}
				}
			}
			
			protected function checkPassFaultEmployee(event:FaultEvent):void
			{
				// TODO Auto-generated method stub
				Alert.show("Error al chequear las claves del Empleado.");
			}		
					
			protected function btnCopyClipBoard_clickHandler(event:MouseEvent):void
			{
				systemClipboard.clear();
				systemClipboard.setData(ClipboardFormats.TEXT_FORMAT,txtobservaciones.text);
			}
			
			
			
			protected function mskdocumento_changeHandler(event:TextOperationEvent):void
			{
				event.preventDefault();
			}
			
		]]>
	</fx:Script>
	<fx:Declarations>
		<s:XMLListCollection id="tarjetas" source="{xmltarjetas.item}"/>
		<s:XMLListCollection id="productlist" source="{xmlproduct.producto}"/>
		<s:XMLListCollection id="listhistoricoselected" />
		<s:ArrayCollection id="listhistorico"  />
		<!-- Place non-visual elements (e.g., services, value objects) here -->
		<s:ArrayCollection id="arrayDg"/>
		<s:DateTimeFormatter id="dtf" dateTimePattern="dd/MM/yyyy"/>
		<s:WebService id="wsnotas" wsdl="http://192.168.1.101:8080/ServiceNotaPedido/NotaPedidoWs?WSDL" showBusyCursor="true">
			<s:operation name="actualizarNotaPedido"
						 result="actualizarHandlerNota(event)"
						 fault="falloActualizarHandlerNota(event)">
				
			</s:operation>
			<s:operation name="cancelarNotaPedido"
						 result="cancelarHandler(event)"
						 fault="cancelarHandlerFault(event)">
				
			</s:operation>
			<s:operation name="anularNotaPedido"
						 result="anularHandler(event)"
						 fault="anularFaultHandler(event)">
				
			</s:operation>
			<s:operation name="entregarNotaPedido"
						 result="operacionEntregarNotaHandler(event)"
						 fault="operacionFaultEntregaNotaHandler(event)">
				
			</s:operation>
			<s:operation name="getRecorCountNotas"
						 result="getRecordCountNotasHandler(event)"
						 fault="getFaultRecordCountHandler(event)">
				
			</s:operation>
			<s:operation name="selectAllNotas"
						 result="operation2_resultHandler(event)"
						 fault="operation2_faultHandler(event)">
				
			</s:operation>
			<s:operation name="verNotasPedidoPaginadas"
						 result="resultPaginadoHandler(event)"
						 fault="faultPaginadoHandler(event)">
				
			</s:operation>
			<s:operation name="selectUnaNota"
						 result="operationSelectOneNota(event)"
						 fault="operationOneNotaFault(event)"
				/>
			<s:operation name="eliminarNotaDePedido"
						 result="result_deleteNote(event)"
						 fault="fault_deleteNote(event)">
				
			</s:operation>
				
		</s:WebService>
		<s:WebService id="wsempleados" wsdl="http://192.168.1.101:8080/ServicesEmpleados/EmpleadosWs?WSDL" showBusyCursor="false">
			<s:operation name="selectAllEmpleados"
						 fault="faultAllEmploye(event)"
						 result="selFullEmploye(event)">
				
			</s:operation>
			<s:operation name="checkPassEmployee"
						 result="checkPassHandlerEmployee(event)"
						 fault="checkPassFaultEmployee(event)">
				
			</s:operation>
		</s:WebService>
		<s:WebService id="wstarjetascreditodebito" 
					  wsdl="http://192.168.1.101:8080/ServiceTarjetas/TartjetasWs?WSDL" showBusyCursor="true"
					  >
			<s:operation name="searchAllTarjetasCreditoDebito" result="operation4_resultHandler(event)" fault="operation4_faultHandler(event)">
				
			</s:operation>
		</s:WebService>
		<s:WebService id="productosWs" wsdl="http://192.168.1.101:8080/ServiceProductos/ProductosWs?wsdl"
					  showBusyCursor="true">
			<s:operation name="searchAllProductos"
						 fault="faultSearchAllProducts(event)"
						 result="operationResultSearchAllProduct(event)">
				
			</s:operation>
		</s:WebService>
		<s:XMLListCollection id="notas" source="{xmlNotas.item}"/>
	
		<s:XMLListCollection id="detallenotas"/>		
		<s:ArrayCollection id="detallenotasList"/>
		<s:CurrencyFormatter id="cf" currencySymbol="$" fractionalDigits="3" locale="es-AR"  
							 decimalSeparator="." groupingSeparator="," currencyISOCode="locale and OS dependent" useCurrencySymbol="false"/>
		<s:Label x="479" y="150" text="Observaciones:"/>
		<s:XMLListCollection id="empleadoslist" source="{xmlListEmpleados.item}"/>
		<s:NumberFormatter id="formaternumbergrid" fractionalDigits="3" decimalSeparator="."  />
	</fx:Declarations>
	
	<s:Button id="first_btn" x="2" y="127" width="85" height="27" label="&lt;&lt;"
			  click="first_clickHandler(event)" enabled="false" fontSize="16" fontWeight="bold"/>
	<s:Button id="prev_btn" x="313" y="127" width="88" height="27" label="&lt;"
			  click="prev_btn_clickHandler(event)" enabled="false" fontSize="16" fontWeight="bold"/>
	<s:Button id="next_btn" x="610" y="127" width="84" height="26" label="&gt;"
			  click="next_btn_clickHandler(event)" enabled="false" fontSize="16" fontWeight="bold"/>
	<s:Button id="last_btn" x="919" y="127" width="89" height="28" label="&gt;&gt;"
			  click="last_clickHandler(event)" enabled="false" fontSize="16" fontWeight="bold"/>
	
	<s:DataGrid id="adgNotas" x="2" y="0" width="1006" height="127"
				alternatingRowColors="[#ffffff,#fcff4f7]" click="adgNotas_clickHandler(event)"
				doubleClick="adgNotas_doubleClickHandler(event)" doubleClickEnabled="true"
				selectedIndex="0" selectionMode="singleRow"
				toolTip="Haga doble click para seleccionar la Nota correspondiente"
				variableRowHeight="true">
		<s:columns>
			<s:ArrayList>
				<s:GridColumn headerText="N° Nota" dataField="id"/>
				<s:GridColumn headerText="Fecha Compra" dataField="fechacompra"
							  rendererIsEditable="true"  >
					<s:itemRenderer>
						<fx:Component>
							<s:GridItemRenderer>
								<mx:DateField editable="true" text="@{data.fechacompra}" formatString="DD/MM/YYY" 
											  horizontalCenter="0" verticalCenter="0"
											  width="80%"/>
							</s:GridItemRenderer>
						</fx:Component>
					</s:itemRenderer>
					
				</s:GridColumn>
				<s:GridColumn headerText="Fecha Entrega" dataField="fechaentrega"
							  rendererIsEditable="true"  >
					<s:itemRenderer>
						<fx:Component>
							<s:GridItemRenderer>
								<mx:DateField editable="true" text="@{data.fechaentrega}" formatString="DD/MM/YYY" 
											  horizontalCenter="0" verticalCenter="0"
											  width="80%"/>
							</s:GridItemRenderer>
						</fx:Component>
					</s:itemRenderer>
					
				</s:GridColumn>
				<s:GridColumn headerText="Total General" dataField="total" formatter="{formaternumbergrid}"/>
				<s:GridColumn headerText="Descuento Total" dataField="descuentonota" formatter="{formaternumbergrid}"/>
				<s:GridColumn headerText="Total a Pagar" dataField="montototalapagar" formatter="{formaternumbergrid}"/>
				<s:GridColumn headerText="Recargo Total" dataField="recargototal" formatter="{formaternumbergrid}"/>
				<s:GridColumn headerText="Saldo" dataField="saldo" formatter="{formaternumbergrid}"/>
				<s:GridColumn  dataField="horacompra" visible="false"/>
				<s:GridColumn  dataField="fechaanulado" visible="false"/>
				<s:GridColumn  dataField="fecancel" visible="false"/>
				
			</s:ArrayList>
		</s:columns>		
	</s:DataGrid>
	<s:Label x="413" y="134" fontFamily="Verdana" fontSize="10" text="Vendedor Expidio:"/>
	<s:Label x="6" y="213" fontFamily="Verdana" fontSize="16" fontWeight="normal" text="Cliente:"/>
	<s:Label id="lblnombreyapecli" x="88" y="201" width="288" height="25" fontSize="16"
			 verticalAlign="bottom"/>
	<s:TextArea id="txtobservaciones" x="384" y="166" width="845" height="156" editable="true"
				enabled="true" maxChars="32000" selectable="true" />
	
	<mx:AdvancedDataGrid id="adglistpedprod" x="7" y="332" width="886" height="129"
						 alternatingItemColors="[#adf1f5, white]"
						editable="item group summary"	
						 designViewDataType="flat" doubleClickEnabled="true" 
						 fontFamily="Verdana" itemDoubleClick="adglistpedprod_itemDoubleClickHandler(event)" fontSize="15"
						 rowCount="8"
						 variableRowHeight="true" toolTip="Para editar, cantidad, precio, etc seleccione la celda correspondiente, para borrar un producto haga doble click">
		<mx:columns>
			<mx:AdvancedDataGridColumn id="idproducto" visible="false" dataField="idproduct"/>			
			<mx:AdvancedDataGridColumn  width="52" dataField="id" editable="false"
									   fontFamily="Verdana" fontSize="10" headerText="Codigo"
									   resizable="false" textAlign="left" textDecoration="none"/>
			<mx:AdvancedDataGridColumn width="84" dataField="name" editable="false"
									   fontFamily="Verdana" fontSize="10" headerText="Descripcion"
									   resizable="false" textAlign="left"/>
			<mx:AdvancedDataGridColumn width="35" dataField="countt" editable="true"  
									   fontFamily="Verdana" fontSize="10" headerText="Cantidad"
									   resizable="false" sortable="false" textAlign="center"/>
			<mx:AdvancedDataGridColumn width="45" dataField="price" draggable="false" editable="true"
									   fontFamily="Verdana" fontSize="10" formatter="{cf}"
									   headerText="PrecioU" resizable="true" sortable="false" color="green"
									   textAlign="center"/>
			<mx:AdvancedDataGridColumn editable="true" dataField="porc_desc" fontFamily="Verdana" fontSize="10"
									   headerText="% Descuento" resizable="false" sortable="false" color="red"
									   textAlign="center" width="33"/>
			<mx:AdvancedDataGridColumn width="33" dataField="prec_descuento" editable="false"
									   fontFamily="Verdana" fontSize="10" formatter="{cf}" color="red"
									   headerText="Precio Desc"/>
			<mx:AdvancedDataGridColumn width="52" color="red" dataField="subtotal" draggable="false"
									   editable="false" fontFamily="Verdana" fontSize="10"
									   fontWeight="bold" formatter="{cf}" headerText="SubTotal"
									   resizable="false" sortable="false" textAlign="right"/>
			<mx:AdvancedDataGridColumn  visible="false" dataField="idnota"/>
		</mx:columns>
	</mx:AdvancedDataGrid>
	<s:Label x="583" y="481" color="#062C6C" fontFamily="Verdana" fontSize="16" fontWeight="bold"
			 text="TOTAL GENERAL $:" verticalAlign="top"/>
	<s:Label id="lblTotGral" x="752" y="479" width="124" color="#062C6C" fontFamily="Verdana"
			 fontSize="16" fontWeight="bold" text="0.0" textAlign="right" verticalAlign="bottom"/>
	<s:Label x="587" y="517" color="#06820F" fontFamily="Verdana" fontSize="16" fontWeight="bold"
			 text="TOTAL A PAGAR $:"/>
	<s:Label id="lblTotApagar" x="749" y="516" width="127" color="#06820F" fontFamily="Verdana"
			 fontSize="16" fontWeight="bold" text="0.0" textAlign="right" verticalAlign="bottom"/>
	<s:Label x="556" y="498" width="200" height="14" color="#F84B07" fontFamily="Verdana"
			 fontSize="16" fontWeight="bold" text="DESCUENTO TOTAL $:"/>
	<s:Label id="lbldescuento" x="751" y="498" width="125" color="#F84B07" fontFamily="Verdana"
			 fontSize="16" fontWeight="bold" text="0.0" textAlign="right"/>
	<s:Label x="531" y="537" width="223" color="#04667F" fontFamily="Verdana" fontSize="16"
			 fontWeight="bold" text="TOTAL CON RECARGO $:" textAlign="right"/>
	<s:Label x="531" y="555" width="223" color="#89908D" fontFamily="Verdana" fontSize="16"
			 fontWeight="bold" text="SALDO $:" textAlign="right"/>
	<s:Label id="lbltotalconrecargo" x="752" y="535" width="124" color="#04667F" fontFamily="Verdana"
			 fontSize="16" fontWeight="bold" text="0.0" textAlign="right"/>
	<s:Label id="lblsaldo" x="752" y="554" width="124" color="#89908D" fontFamily="Verdana"
			 fontSize="16" fontWeight="bold" text="0.0" textAlign="right"/>
	<s:Label x="567" y="591" fontFamily="Verdana" fontSize="16" fontWeight="normal" text="RECARGO %:"
			 textAlign="right"/>
	<controls:MaskedTextInput id="mskrecargo" x="679" y="583" width="74" fontFamily="Verdana" text="0.000" maxChars="5"
							  fontSize="16" restrict="0-9." toolTip="Ingresa un Porcentaje de recargo total para los productos cargados, para poder realizar el calculo debe presionar la tecla Enter"/>
	<s:Label x="554" y="620" width="123" fontFamily="Verdana" fontSize="16" fontWeight="normal"
			 text="ANTICIPO $:" textAlign="right"/>
	<controls:MaskedTextInput text="0.000" maxChars="6" id="mskAnticipo" x="679" y="612" width="74" fontFamily="Verdana"
							  fontSize="16" restrict="0-9." toolTip="Calcula el anticipo, para poder realizar el calculo debe presionar la tecla Enter"/>
	<s:Label x="5" y="247" fontFamily="Verdana" fontSize="16" text="Producto:"/>
	<s:Label x="5" y="277" fontFamily="Verdana" fontSize="16" text="Precio $:"/>
	<s:TextInput id="txtpreciop" x="88" y="268" width="233" fontSize="16" fontWeight="bold"
				 maxChars="6" restrict="0-9." tabEnabled="false" prompt="Ingrese precio de producto..."/>
	<s:Label x="5" y="310" fontFamily="Verdana" fontSize="16" text="Cantidad:"/>
	<controls:MaskedTextInput id="mskcantidad" x="88" y="301" width="55" fontFamily="Verdana"
							  tabEnabled="false" fontSize="16" fontWeight="bold" maxChars="3" restrict="0-9"/>
	<components:AutoComplete id="cmbproduct" prompt="Ingrese un Producto..." x="88" y="234" width="233" allowDuplicates="false"
							 dropDownRowCount="10" fontSize="16" fontWeight="bold"
							 labelField="descripcion" matchType="beginning" tabEnabled="false">
	</components:AutoComplete>
	<s:Button id="btnRemover" x="7" y="466" width="153" height="40" label="Remover Todo"
			  click="btnRemover_clickHandler(event)" enabled="false" fontSize="16"
			  toolTip="Elimina todos Los productos del Listado!!!"/>
	<s:Button id="brncargarunproducto" x="7" y="508" width="153" height="38" label="Cargar Producto"
			  click="brncargarunproducto_clickHandler(event)" fontSize="16"
			  toolTip="Muestra una Ventana para cargar un Producto"/>
	<s:Label x="180" y="309" fontFamily="Verdana" fontSize="16" fontWeight="normal" text="% Descuento:"/>
	<controls:MaskedTextInput text="0.00" maxChars="5" x="296" y="301" width="60" fontFamily="Verdana" fontSize="16" id="txtdescuento" restrict="0-9." toolTip="Ingresa un porcentaje de descuento, aplicable a todos los productos de la planilla"/>
	<s:Label x="902" y="441" fontSize="16" fontWeight="bold" text="EMPLEADOS:"/>
	<components:AutoComplete id="cmbVendedores" x="902" y="458" width="261" allowDuplicates="false"
							 dropDownRowCount="10" fontFamily="Verdana" fontSize="16"
							 fontWeight="bold" labelField="nameuser" matchType="beginning"
							 prompt="Seleccione un Empleado...">
	</components:AutoComplete>
	<s:Label x="1015" y="4" fontSize="14" fontWeight="bold" text="Nota de pedido entregada"/>
	<s:Label x="1014" y="54" fontSize="14" fontWeight="bold" text="Nota de pedido cancelada"/>
	<s:VGroup x="1017" y="67" width="38" height="44">
	</s:VGroup>
	<s:RadioButton id="rdbentregadosi" x="1016" y="16" label="Si" groupName="GrupoEntregado"/>
	<s:RadioButton id="rdbentregadono" x="1016" y="34" label="No" groupName="GrupoEntregado"
				   selected="true"/>
	<s:Label x="1018" y="111" fontSize="14" fontWeight="bold" text="Nota anulada"/>
	<s:VGroup x="1017" y="123" width="39" height="44">
	</s:VGroup>
	<s:Label x="902" y="495" fontFamily="Arial" fontSize="16" fontWeight="bold" text="PASSWORD:"/>
	<s:TextInput id="txtpassword" x="903" y="516" width="260" displayAsPassword="true"
				 enter="txtpassword_enterHandler(event)" fontFamily="Verdana" fontSize="16"
				 fontStyle="italic" maxChars="12" prompt="Ingresar clave de vendedor..."
				 restrict="[a-zA-Z0-9_-*!#$%/()=?]"/>
	<s:Button id="btnEntregarNota" x="1059" y="19" width="91" height="33" label="Entregar"
			  click="btnguardarentregada_clickHandler(event)" fontSize="16"
			  toolTip="Almacena el estado de Entregado de la Nota de Pedido Seleccionada"/>
	<s:Button id="btnCancelarNota" x="1063" y="71" width="90" height="33" label="Cancelar"
			  click="buttonCancelarHandler(event)" fontSize="16"
			  toolTip="Cambia el estado cancelada de la Nota de Pedido Seleccionada"/>
	<s:Button id="btnAnularNota" x="1063" y="127" width="88" height="33" label="Anular"
			  click="buttonAnularHandler(event)" fontSize="16"
			  toolTip="Cambia el estado de anulada de la Nota de Pedido Seleccionada"/>
	<components:AdvancedAutoComplete id="cmbTarjetasCreditoDebito" prompt="Seleccione una Tarjeta de Crédito..." x="902" y="351" width="295"
									 fontSize="16" labelField="descripcion"
									 toolTip="Seleccione una Tarjeta de Crédito o Débito si el cliente utiliza esta forma de pago!!!">
	</components:AdvancedAutoComplete>
	<s:Label x="901" y="337" fontSize="14" fontWeight="bold" text="Tarjetas de Crédito / Débito" toolTip="Seleccione si o no para registrar que la nota de pedido fue entregada al Cliente"/>
	<controls:MaskedTextInput id="txtNumerodeCuponPagoTarjeta" x="903" y="406" fontFamily="Verdana"
							  fontSize="16" inputMask="####-####-####-####" maxChars="19"
							  toolTip="Ingrese en Número de Tarjeta de Crédito o Débito del Plástico"/>
	<s:Label x="901" y="390" fontSize="14" fontWeight="bold"
			 text="Número de cupón tarjeta de credito/debito:"/>
	<s:DataGrid id="adghistorico" x="904" y="563" width="203" height="102"
				alternatingRowColors="[#adf1f5, white]" fontFamily="Verdana" fontSize="10"
				requestedRowCount="4">
		<s:columns>
			<s:ArrayList>
				<s:GridColumn dataField="fecharegistro" headerText="FechaRegistro"></s:GridColumn>
				<s:GridColumn dataField="anticipo" formatter="{cf}" headerText="Anticipo"></s:GridColumn>				
			</s:ArrayList>
		</s:columns>		
	</s:DataGrid>
	<s:Label x="904" y="548" fontSize="16" fontWeight="bold" text="HISTORICO DE ANTICIPOS"/>
	<s:Button id="btnRegargarlistado" x="7" y="548" width="153" height="37" label="Recargar Listado"
			  click="btnRegargarlistado_clickHandler(event)" enabled="false" fontSize="16"/>
	<controls:MaskedTextInput id="mskisearchidnota" x="264" y="481" width="232" fontSize="16"
							  restrict="0-9" textAlign="center"
							  toolTip="Ingrese Número de Nota de Pedido, debe presinar la tecla Enter para realizar la Búsqueda!!!"/>
	<s:Label x="262" y="467" fontFamily="Verdana" fontSize="16" fontWeight="normal"
			 text="BUSCAR NOTA DE PEDIDO"/>
	<s:Button id="btnImprimir" x="7" y="588" width="153" height="35" label="Imprimir"
			  click="btnImprimir_clickHandler(event)" enabled="false" fontSize="16"
			  toolTip="Imprimie una nota de pedido seleccionada del listado"/>
	<s:Button id="btnactualizarNota" x="8" y="626" width="152" height="39" label="actualizarNota"
			  click="btnactualizarNota_clickHandler(event)" enabled="false" fontSize="16"
			  toolTip="Actualiza el estado de la nota de pedido"/>
	<s:Button id="btnCloseClientComponent" x="1203" y="1" width="27" height="19" icon="assets/icon_close.png" click="btnCloseClientComponent_clickHandler(event)"/>
	<s:RadioButton id="rdbAnuladasi" x="1021" y="125" label="Si" groupName="anulada"/>
	<s:RadioButton id="rdbAnuladano" x="1021" y="149" label="No" groupName="anulada" selected="true"/>
	<s:Label x="7" y="175" fontSize="16" fontWeight="normal" text="Documento:"/>
	<s:TextInput id="mskdocumento" x="97" y="163" width="168"
				 change="mskdocumento_changeHandler(event)" editable="false" fontFamily="Verdana"
				 fontSize="20" maxChars="8" restrict="0-9"/>
	<s:Label x="274" y="165" fontSize="16" fontWeight="normal" text="Observaciones:"/>
	<s:Label id="lblvendedoranulo" x="808" y="131" width="87" height="15" fontFamily="Verdana"
			 fontSize="10" verticalAlign="bottom"/>
	<s:Label id="lblvendedorentrego" x="808" y="147" width="87" height="11" fontFamily="Verdana"
			 fontSize="10" verticalAlign="bottom"/>
	<s:Label x="413" y="146" fontFamily="Verdana" fontSize="10" text="Vendedor Canceló:"/>
	<s:Label x="709" y="135" fontFamily="Verdana" fontSize="10" text="Vendedor Anuló:"/>
	<s:Label x="709" y="149" fontFamily="Verdana" fontSize="10" text="Vendedor Entregó:"/>
	<s:Label id="lblexpidiovendedor" x="511" y="128" width="87" height="16" fontFamily="Verdana"
			 fontSize="10" verticalAlign="bottom"/>
	<s:Label id="lblvendedocancelo" x="511" y="140" width="87" height="16" fontFamily="Verdana"
			 fontSize="10" verticalAlign="bottom"/>
	<s:Label x="553" y="646" fontFamily="Verdana" fontSize="16" text="DESCUENTO $:" />
	<controls:MaskedTextInput id="mskdescuentopesos" toolTip="Calcula el descuento en pesos, para poder realizar el calculo debe presionar la tecla Enter" x="680" y="639" width="74" fontFamily="Verdana" text="0.000" maxChars="5"  restrict="0-9."
							  fontSize="16"/>
	<s:RadioButton id="rdbcanceladanotasi" x="1020" y="67" label="Si" groupName="notaCancelada"/>
	<s:RadioButton id="rdbcanceladanotano" x="1020" y="91" label="No" groupName="notaCancelada"
				   selected="true"/>
	<s:Button id="btnEliminarNota" x="297" y="508" width="139" height="38" label="Eliminar"
			  click="btn_delete_One_OrderForm(event)" enabled="false" fontFamily="Verdana" fontSize="16"
			  toolTip="Elimina una Nota de Pedido, seleccionada previamente"/>
	<s:Label id="lblUltimaActualizacion" x="184" y="646" width="319" color="#F10909"
			 fontFamily="Arial" fontSize="11" fontWeight="bold"/>
	<s:CheckBox id="chkEfectivo" x="761" y="617" width="135" label="ANTICIPO EFECTIVO"
				 selected="true" toolTip="Active si el anticipo es en efectivo, para anticipos pagados con tarjeta se debe desactivar!"/>
	<s:Button id="btnCopyClipBoard" x="1116" y="322" width="113" height="29" label="Copiar"
			  click="btnCopyClipBoard_clickHandler(event)" fontSize="16"
			  toolTip="Copia el texto de Observaciones al portapapeles para poder ser pegado en otra aplicación!"/>
</s:Group>



